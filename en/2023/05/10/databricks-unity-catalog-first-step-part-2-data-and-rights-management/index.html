<!doctype html><html lang=en><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta http-equiv=x-ua-compatible content="IE=edge"><meta charset=utf-8><meta name=robots content="noindex, nofollow, noarchive, nosnipper, noodp, noydir"><meta name=google content="notranslate, noimageindex"><meta name=slurp content="notranslate, noimageindex"><meta name=msnbot content="notranslate, noimageindex"><meta name=bingbot content="notranslate, noimageindex"><meta name=generator content="Hugo 0.115.4"><link rel=stylesheet href=https://www.pragmatias.fr/css/bootstrap.min.css><link rel=stylesheet href=https://www.pragmatias.fr/css/pragmatias.css><script src=https://www.pragmatias.fr/js/jquery-3.6.0.slim.min.js></script>
<script src=https://www.pragmatias.fr/js/popper.min.js></script>
<script src=https://www.pragmatias.fr/js/bootstrap.bundle.min.js></script>
<link rel=alternate type=application/rss+xml href=https://www.pragmatias.fr/en/feed.xml><title>Databricks : Unity Catalog - First Step - Part 2 - Data and Rights Management</title><body><div class="navbar navbar-expand-md prag-bg-primary prag-header" role=navigation><div class="container-fluid justify-content-center"><div class=navbar-brand><a href=https://www.pragmatias.fr/en/blog/><img src=/images/logo_pragmatias.svg alt=pragmatias></a></div><button class="navbar-toggler justify-content-end prag-navbar" type=button data-toggle=collapse data-target=#navbarSupportedContent1,#navbarSupportedContent2 aria-controls=navbarSupportedContent1 aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent1><ul class="navbar-nav text-center"><li class=nav-item><a class=nav-link href=https://www.pragmatias.fr/en/blog/>Blog</a></li><li class=nav-item><a class=nav-link href=https://www.pragmatias.fr/en/tags/>Tags</a></li><li class=nav-item><a class=nav-link href=https://www.pragmatias.fr/en/archives/>Archives</a></li></ul></div><div class="collapse navbar-collapse justify-content-md-end" id=navbarSupportedContent2><ul class="navbar-nav flex-row justify-content-center"><li class=nav-item><a href=https://www.pragmatias.fr/2023/05/10/databricks-unity-catalog-d%C3%A9couverte-partie-2-gestion-des-donn%C3%A9es/ class="prag_header_svg mr-1 ml-1"><img src=/images/france-flag-round-xs-24.png alt=FranÃ§ais></a></li><li class=nav-item><a href=https://www.pragmatias.fr/en/feed.xml title="Pragmatias Blog" class="prag_header_svg mr-1 ml-1"><svg height="24" style="enable-background:new 0 0 508.52 508.52" viewBox="0 0 508.52 508.52" width="24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path style="fill-rule:evenodd;clip-rule:evenodd;fill:" d="M254.26.0C113.845.0.0 113.845.0 254.26s113.845 254.26 254.26 254.26 254.26-113.845 254.26-254.26C508.52 113.813 394.675.0 254.26.0zM137.141 412.441c-22.852.0-41.413-18.434-41.413-41.285.0-22.693 18.561-41.349 41.413-41.349 22.915.0 41.444 18.656 41.476 41.349C178.618 393.976 160.088 412.441 137.141 412.441zM241.197 412.791c0-39.029-15.16-75.674-42.62-103.071-27.46-27.524-63.978-42.716-102.785-42.716V207.38c113.177.0 205.315 92.137 205.315 205.41h-59.91zM347.001 412.727c0-138.603-112.669-251.399-251.145-251.399v-59.624c171.435.0 310.96 139.589 310.96 311.023H347.001z"/></svg></a></li><li class=nav-item><a href=mailto:contact@pragmatias.fr title=Mail class="prag_header_svg mr-1 ml-1"><svg height="24" style="enable-background:new 0 0 299.997 299.997" viewBox="0 0 299.997 299.997" width="24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path style="fill-rule:evenodd;clip-rule:evenodd;fill:" d="M149.996.0C67.157.0.001 67.158.001 149.997c0 82.837 67.156 150 149.995 150s150-67.163 150-150C299.996 67.158 232.835.0 149.996.0zM149.999 52.686l88.763 55.35H61.236l88.763-55.35zm89.869 143.737h-.009c0 8.878-7.195 16.072-16.072 16.072H76.211c-8.878.0-16.072-7.195-16.072-16.072v-84.865c0-.939.096-1.852.252-2.749l84.808 52.883c.104.065.215.109.322.169.112.062.226.122.34.179.599.309 1.216.558 1.847.721.065.018.13.026.195.041.692.163 1.393.265 2.093.265h.005c.005.0.01.0.01.0.7.0 1.401-.099 2.093-.265.065-.016.13-.023.195-.041.63-.163 1.245-.412 1.847-.721.114-.057.228-.117.34-.179.106-.06.218-.104.322-.169l84.808-52.883c.156.897.252 1.808.252 2.749v84.865z"/></svg></a></li><li><a href=https://github.com/pragmatias/ title=github class="prag_header_svg mr-1 ml-1"><svg height="24" style="enable-background:new 0 0 438.549 438.549" viewBox="0 0 438.549 438.549" width="24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path style="fill-rule:evenodd;clip-rule:evenodd;fill:" d="M409.132 114.573c-19.608-33.596-46.205-60.194-79.798-79.8C295.736 15.166 259.057 5.365 219.271 5.365c-39.781.0-76.472 9.804-110.063 29.408-33.596 19.605-60.192 46.204-79.8 79.8C9.803 148.168.0 184.854.0 224.63c0 47.78 13.94 90.745 41.827 128.906 27.884 38.164 63.906 64.572 108.063 79.227 5.14.954 8.945.283 11.419-1.996 2.475-2.282 3.711-5.14 3.711-8.562.0-.571-.049-5.708-.144-15.417-.098-9.709-.144-18.179-.144-25.406l-6.567 1.136c-4.187.767-9.469 1.092-15.846 1-6.374-.089-12.991-.757-19.842-1.999-6.854-1.231-13.229-4.086-19.13-8.559-5.898-4.473-10.085-10.328-12.56-17.556l-2.855-6.57c-1.903-4.374-4.899-9.233-8.992-14.559-4.093-5.331-8.232-8.945-12.419-10.848l-1.999-1.431c-1.332-.951-2.568-2.098-3.711-3.429-1.142-1.331-1.997-2.663-2.568-3.997-.572-1.335-.098-2.43 1.427-3.289s4.281-1.276 8.28-1.276l5.708.853c3.807.763 8.516 3.042 14.133 6.851 5.614 3.806 10.229 8.754 13.846 14.842 4.38 7.806 9.657 13.754 15.846 17.847 6.184 4.093 12.419 6.136 18.699 6.136s11.704-.476 16.274-1.423c4.565-.952 8.848-2.383 12.847-4.285 1.713-12.758 6.377-22.559 13.988-29.41-10.848-1.14-20.601-2.857-29.264-5.14-8.658-2.286-17.605-5.996-26.835-11.14-9.235-5.137-16.896-11.516-22.985-19.126-6.09-7.614-11.088-17.61-14.987-29.979-3.901-12.374-5.852-26.648-5.852-42.826.0-23.035 7.52-42.637 22.557-58.817-7.044-17.318-6.379-36.732 1.997-58.24 5.52-1.715 13.706-.428 24.554 3.853 10.85 4.283 18.794 7.952 23.84 10.994 5.046 3.041 9.089 5.618 12.135 7.708 17.705-4.947 35.976-7.421 54.818-7.421s37.117 2.474 54.823 7.421l10.849-6.849c7.419-4.57 16.18-8.758 26.262-12.565 10.088-3.805 17.802-4.853 23.134-3.138 8.562 21.509 9.325 40.922 2.279 58.24 15.036 16.18 22.559 35.787 22.559 58.817.0 16.178-1.958 30.497-5.853 42.966-3.9 12.471-8.941 22.457-15.125 29.979-6.191 7.521-13.901 13.85-23.131 18.986-9.232 5.14-18.182 8.85-26.84 11.136-8.662 2.286-18.415 4.004-29.263 5.146 9.894 8.562 14.842 22.077 14.842 40.539v60.237c0 3.422 1.19 6.279 3.572 8.562 2.379 2.279 6.136 2.95 11.276 1.995 44.163-14.653 80.185-41.062 108.068-79.226 27.88-38.161 41.825-81.126 41.825-128.906C438.536 184.851 428.728 148.168 409.132 114.573z"/></svg></a></li></ul></div></div></div><div id=content><div class=container-fluid><article class="blog-post blog-post-with-toc"><header><h2 class=blog-post-title>Databricks : Unity Catalog - First Step - Part 2 - Data and Rights Management</h2><div class=blog-post-date><span>Last update : 10 May 2023</span></div><div class=blog-post-date>Reading time : 22 minute(s) - 4570 words</div><div class=blog-post-tags><strong>Tags:</strong>
<a href=https://www.pragmatias.fr/en/tags/databricks/>Databricks</a>
<a href=https://www.pragmatias.fr/en/tags/unity-catalog/>Unity Catalog</a></div></header><aside class=prag-toc><h1 class=prag-toc-head>Summary</h1><div class=prag-toc-body><nav id=TableOfContents><ol><li><a href=#unity-catalog-and-the-object-hierarchy>Unity Catalog and the object hierarchy</a></li><li><a href=#set-up-the-environment>Set-up the environment</a><ol><li><a href=#synthesis>Synthesis</a></li><li><a href=#setting-up>Setting up</a><ol><li><a href=#setting-up-a-dataset-on-the-aws-s3-resource>Setting up a dataset on the AWS S3 resource</a></li><li><a href=#setting-up-the-containers-on-the-unity-catalog-metastore>Setting up the containers on the Unity Catalog Metastore</a></li></ol></li></ol></li><li><a href=#group-management>Group management</a><ol><li><a href=#synthesis-1>Synthesis</a></li><li><a href=#practical-application>Practical application</a></li></ol></li><li><a href=#rights-management>Rights management</a><ol><li><a href=#synthesis-2>Synthesis</a></li><li><a href=#practical-application-1>Practical application</a></li></ol></li><li><a href=#storage-management>Storage management</a><ol><li><a href=#synthesis-3>Synthesis</a></li><li><a href=#practical-application-2>Practical application</a></li></ol></li><li><a href=#clean-environment>Clean environment</a></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#resources>Resources</a><ol><li><a href=#creation-of-a-sql-warehouse>Creation of a SQL Warehouse</a></li></ol></li></ol></nav></div></aside><a id=showTopBtn href=# class=prag-sticky-bot><svg height="24" id="Layer_1" style="enable-background:new 0 0 438.533 438.533" viewBox="0 0 438.533 438.533" width="24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path style="fill-rule:evenodd;clip-rule:evenodd;fill:" d="M409.133 109.203c-19.608-33.592-46.205-60.189-79.798-79.796C295.736 9.801 259.058.0 219.273.0c-39.781.0-76.47 9.801-110.063 29.407-33.595 19.604-60.192 46.201-79.8 79.796C9.801 142.8.0 179.489.0 219.267c0 39.78 9.804 76.463 29.407 110.062 19.607 33.592 46.204 60.189 79.799 79.798 33.597 19.605 70.283 29.407 110.063 29.407s76.47-9.802 110.065-29.407c33.593-19.602 60.189-46.206 79.795-79.798 19.603-33.596 29.403-70.284 29.403-110.062C438.533 179.485 428.732 142.795 409.133 109.203zM361.449 231.831l-25.981 25.981c-3.613 3.613-7.901 5.42-12.847 5.42-4.948.0-9.229-1.807-12.847-5.42l-53.954-53.961v143.32c0 4.948-1.813 9.232-5.428 12.847-3.613 3.62-7.898 5.427-12.847 5.427h-36.547c-4.948.0-9.231-1.807-12.847-5.427-3.617-3.614-5.426-7.898-5.426-12.847v-143.32l-53.959 53.961c-3.431 3.425-7.708 5.133-12.85 5.133-5.14.0-9.423-1.708-12.85-5.133l-25.981-25.981c-3.422-3.429-5.137-7.714-5.137-12.852.0-5.137 1.709-9.419 5.137-12.847l103.356-103.353 25.981-25.981c3.427-3.425 7.71-5.14 12.847-5.14 5.142.0 9.423 1.715 12.849 5.14l25.98 25.981 103.35 103.353c3.432 3.427 5.14 7.71 5.14 12.847C366.589 224.117 364.881 228.402 361.449 231.831z"/></svg></a><script>$(document).ready(function(){$("#showTopBtn").removeClass("prag-sticky-bot"),$("#showTopBtn").addClass("prag-sticky-hide"),$(function(){$(window).scroll(function(){$(this).scrollTop()>900?($("#showTopBtn").addClass("prag-sticky-bot"),$("#showTopBtn").removeClass("prag-sticky-hide")):($("#showTopBtn").addClass("prag-sticky-hide"),$("#showTopBtn").removeClass("prag-sticky-bot"))})})})</script><div class=blog-post-main><p>We are going to discover the data management with the <a href=https://docs.databricks.com/data-governance/unity-catalog/index.html>Unity Catalog</a> solution and more precisely the management of rights (Groups and Users) and storage (Tables).</p><p>We will use a Databricks Account on AWS to perfrom this discovery.</p><p><em>Note: Work is based on the state of the Unity Catalog solution at the end of Q1 2023 on AWS and Azure.</em></p><h1 id=unity-catalog-and-the-object-hierarchy>Unity Catalog and the object hierarchy</h1><p>Unity Catalog is the Databricks solution that allows to have a unified and centralized governance for all the data managed by the Databricks resources as well as to secure and facilitate the management and the sharing of the data to all the internal and external actors of an organization.</p><p>You can get a more complete overview by reading the <a href=https://docs.databricks.com/data-governance/unity-catalog/index.html>official documentation</a></p><p>Reminder concerning the hierarchy of objects :
<a href=/blog/web/20230510_databricks_unity_catalog_schema_01.png><img src=/blog/web/20230510_databricks_unity_catalog_schema_01.png alt=schema_01></a></p><p>The objects are :</p><ul><li>Storage Credential : This object is directly associated with the Metastore and is used to store access to a cloud provider (for example AWS S3) allowing the Unity Catalog solution to manage data rights</li><li>External Location : This object is associated with the Metastore and allows you to store the path to a cloud provider (for example an AWS S3 resource) in combination with a Storage Credential to manage data access</li><li>Metastore : Top-level object that can contain metadata</li><li>Catalog : 1st level object allowing to organize data by Schema (also called Database)</li><li>Schema : 2nd and last level object used to organize data (contains tables, views and functions)</li><li>Table : Object used to define the structure and storage of data..</li><li>View : Object used to encapsulate a query using one or more objects (table or view)</li><li>Function : Object allowing to define operations on the data</li></ul><p>When you want to access an object (for example a table), it will be necessary to use the name of the Catalog and the name of the Schema where the object is defined.
Example : <code>select * from catalog.schema.table</code></p><h1 id=set-up-the-environment>Set-up the environment</h1><p>For this discovery, we are going to set up a certain number of elements to be able to handle the different concepts.</p><h2 id=synthesis>Synthesis</h2><p>Regarding Databricks resources :</p><ul><li>The Unity Catalog solution must be activated at the Databricks Account level</li><li>A Unity Catalog Metastore must be attached to the Databricks Workspace</li><li>A SQL Warehouse must exist in the Databricks Workspace</li></ul><p>Regarding groups and users,
We will use the following elements:
<a href=/blog/web/20230510_databricks_unity_catalog_schema_02.png><img src=/blog/web/20230510_databricks_unity_catalog_schema_02.png alt=schema_02></a></p><p>Prerequisites :</p><ul><li>A user with admin rights on the Databricks Account and on the Databricks Workspace</li><li>There must not exist a group named <code>grp_demo</code> at the Databricks Account level and at the Databricks Workspace level</li><li>There must not exist a user named <code>john.do.dbx@gmail.com</code> at the Databricks Account level and at the Databricks Workspace level</li></ul><p>Summary of the actions that will be done :</p><ul><li>Creation of a group named <code>grp_demo</code> at the Databricks Account level.</li><li>Creation of a user named <code>john.do.dbx@gmail.com</code> at the Databricks Account level.</li><li>Addition of the <code>grp_demo</code> group created at the Databricks Account level in the Databricks Workspace</li><li>Added rights on the Workspace Databricks on the group <code>grp_demo</code></li><li>Added the needed rights on Unity Catalog objects at the Databricks Workspace level on the <code>grp_demo</code> group</li></ul><p>Regarding Unity Catalog objects,
We will use the following elements:
<a href=/blog/web/20230510_databricks_unity_catalog_schema_03.png><img src=/blog/web/20230510_databricks_unity_catalog_schema_03.png alt=schema_03></a></p><p>Prerequisites :</p><ul><li>Existence of a Metastore named <code>metastore-sandbox</code> with the Storage Credential named <code>sc-metastore-sandbox</code> to store default data in the AWS S3 resource named <code>s3-dbx-metastore-uc</code></li><li>Create an AWS S3 resource named <code>s3-demo-data-uc</code></li><li>Created an AWS IAM role named <code>role-databricks-demo-data-uc</code> and an AWS IAM policy named <code>policy-databricks-demo-data-uc</code> allowing the Databricks global role to manage access to the AWS S3 resource <code>s3-demo-data-uc</code></li><li>Created a Storage Credential named <code>sc-demo-data-uc</code> allowing the Databricks global role to manage access to the AWS S3 resource <code>s3-demo-data-uc</code></li></ul><p>Summary of the actions that will be done :</p><ul><li>Creation of an External Storage to be able to access the data of the AWS S3 resource named <code>s3-demo-data-uc</code> with Unity Catalog</li><li>Creation of the Catalog <code>ctg_ipp</code> which will contain all the managed elements (stored on the AWS S3 resource named <code>s3-dbx-metastore-uc</code> associated with the Metastore <code>metastore-sandbox</code>)</li><li>Creation of the Catalog <code>ctg_ext</code> which will contain all the external elements (stored on the AWS S3 resource named <code>s3-demo-data-uc</code>)</li><li>Creation of the Schema <code>ctg_ipp.sch_bronze</code> which will create objects managed by Unity Catalog to access data stored on the AWS S3 resource named <code>s3-dbx-metastore-uc</code> (in Delta format only)</li><li>Creation of the Schema <code>ctg_ext.sch_ref</code> which will create the objects to access the data stored on the AWS S3 resource named <code>s3-demo-data-uc</code> (in the form of a CSV file or a Delta file)</li></ul><h2 id=setting-up>Setting up</h2><h3 id=setting-up-a-dataset-on-the-aws-s3-resource>Setting up a dataset on the AWS S3 resource</h3><p>Content of the file <code>ref_products.csv</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>id,lib,brand,os,last_maj
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>1,Pixel 7 Pro,Google,Android,2023-01-01 09:00:00
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>2,Iphone 14,Apple,IOS,2023-01-01 09:00:00
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>3,Galaxy S23,Samsung,Android,2023-01-01 09:00:00
</span></span></code></pre></div><p>Content of the file <code>fct_transactions.csv</code> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>id_trx,ts_trx,id_product,id_shop,id_client,quantity
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>1,2023-04-01 09:00:00,1,2,1,1
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span>2,2023-04-01 11:00:00,1,1,1,3
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>3,2023-04-03 14:00:00,1,2,1,1
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span>4,2023-04-05 08:00:00,3,1,2,9
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span>5,2023-04-06 10:00:00,1,2,1,3
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7</span><span>6,2023-04-06 12:00:00,2,2,1,1
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8</span><span>7,2023-04-10 18:30:00,2,1,2,11
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9</span><span>8,2023-04-10 18:30:00,3,1,2,2
</span></span></code></pre></div><p>Copying data to the <code>demo</code> directory of the AWS S3 resource named <code>s3-demo-data-uc</code> with the AWS CLI tool :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span>aws s3 cp ref_products.csv s3://s3-demo-data-uc/demo/ref_products.csv 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>aws s3 cp fct_transactions.csv s3://s3-demo-data-uc/demo/fct_transactions.csv 
</span></span></code></pre></div><h3 id=setting-up-the-containers-on-the-unity-catalog-metastore>Setting up the containers on the Unity Catalog Metastore</h3><p>The steps are as follows :
Note: Using a user with admin rights on the Metastore</p><ol><li>Creating of an External Location to allow users to store data into the AWS S3 resource named <code>s3-demo-data-uc</code></li><li>Creating a Catalog <code>ctg_ipp</code> and <code>ctg_ext</code></li><li>Creating a Schema <code>ctg_ipp.sch_bronze</code> and <code>ctg_ext.sch_ref</code></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>-- 1. Create external location to access data from s3-demo-data-uc resource
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>CREATE</span> <span style=color:#ff79c6>EXTERNAL</span> <span style=color:#ff79c6>LOCATION</span> <span style=color:#ff79c6>IF</span> <span style=color:#ff79c6>NOT</span> <span style=color:#ff79c6>EXISTS</span> el_demo_data_uc
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>URL <span style=color:#f1fa8c>&#39;s3://s3-demo-data-uc&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#ff79c6>WITH</span> (<span style=color:#ff79c6>STORAGE</span> CREDENTIAL <span style=color:#ff79c6>`</span>sc<span style=color:#ff79c6>-</span>demo<span style=color:#ff79c6>-</span><span style=color:#ff79c6>data</span><span style=color:#ff79c6>-</span>uc<span style=color:#ff79c6>`</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6>COMMENT</span> <span style=color:#f1fa8c>&#39;External Location to access demo data&#39;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4>-- 2. Create Catalog ctg_ipp
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>CREATE</span> <span style=color:#ff79c6>CATALOG</span> <span style=color:#ff79c6>IF</span> <span style=color:#ff79c6>NOT</span> <span style=color:#ff79c6>EXISTS</span> ctg_ipp
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    <span style=color:#ff79c6>COMMENT</span> <span style=color:#f1fa8c>&#39;Catalog for managed data&#39;</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4>-- 2. Create Catalog ctg_ext (for external data)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>CREATE</span> <span style=color:#ff79c6>CATALOG</span> <span style=color:#ff79c6>IF</span> <span style=color:#ff79c6>NOT</span> <span style=color:#ff79c6>EXISTS</span> ctg_ext
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>    <span style=color:#ff79c6>COMMENT</span> <span style=color:#f1fa8c>&#39;Catalog for external data&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#6272a4>-- 3. Create Schema sch_bronze in the Catalog ctg_ipp to store managed data
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>CREATE</span> <span style=color:#ff79c6>SCHEMA</span> <span style=color:#ff79c6>IF</span> <span style=color:#ff79c6>NOT</span> <span style=color:#ff79c6>EXISTS</span> ctg_ipp.sch_bronze
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>    <span style=color:#ff79c6>COMMENT</span> <span style=color:#f1fa8c>&#39;Schema for Bronze Data&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#6272a4>-- 3. Create Schema sch_ref in the Catalog ctg_ext to store external data
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>CREATE</span> <span style=color:#ff79c6>SCHEMA</span> <span style=color:#ff79c6>IF</span> <span style=color:#ff79c6>NOT</span> <span style=color:#ff79c6>EXISTS</span> ctg_ext.sch_ref
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>    <span style=color:#ff79c6>COMMENT</span> <span style=color:#f1fa8c>&#39;Schema for External Data&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>;
</span></span></code></pre></div><h1 id=group-management>Group management</h1><h2 id=synthesis-1>Synthesis</h2><p>A group is an object used to manage access rights on users or other groups.
This allow to set up an access organization in relation to teams or profiles rather than going directly through users.</p><p>There are two types of groups :</p><ul><li>A group at the Account Databricks level makes it possible to manage access to data using the Unity Catalog solution (centralization)</li><li>A local group at Workspace Databricks level allows to manage access at workspace level only and is not compatible with Unity Catalog solution (this is mainly used with Hive Metastore and for Workspace Databricks rights)</li></ul><p>Quota : You can have up to a combination of 10,000 users and 5,000 groups in a Databricks Account</p><p>When a Unity Catalog Metastore is attached to a Databricks Workspace, it is no longer possible to create a local group directly from the Databricks Workspace interface.</p><p>In the context of access management with Unity Catalog, the recommendations are as follows:</p><ul><li>Manage all rights based on the groups defined at the Databricks Account level</li><li>The creation of a group must be done at the level of the Databricks Account to be added at the level of a Databricks Workspace</li><li>Adding or removing a member (user or group) from a group must be done at the Databricks Account level</li><li>The creation of a user can be done at the Databricks Workspace level. It will be automatically added at the Databricks Account level (Warning: it is strongly recommended to manage users and groups based on an IdP (Identity provider) (Azure Active Directory, AWS IAM, &mldr;) to have a centralized and secure Databricks accounts management)</li><li>Data access management is done at the Databricks Workspace level (by the Databricks Workspace administrator or the object owner)</li><li>It is recommended to always define rights at groups level and not users level to facilitate the management of rights over time<ul><li>You can manage groups on several levels to organize rights and users</li></ul></li><li>When importing (creating) a group at the Workspace Databricks level, the Workspace administrator must define the rights (Entitlements) of the group on the Workspace Databricks</li><li>If you want to give the same rights as the user <code>john.do.dbx@gmail.com</code> to another user, you will only need to add this other user in the same groups as the user <code>john.do.dbx@gmail.com</code></li></ul><p>Regarding a group deletion :</p><ul><li>If you delete the group from the Databricks Workspace, it will still exist at the Databricks Account level</li><li>If you remove the group from the Databricks Account, it will automatically be removed from all Databricks Workspaces</li></ul><h2 id=practical-application>Practical application</h2><p>Prerequisites :</p><ul><li>Have an account with the Databricks Account administration role/right</li><li>Have an account with the Databricks Workspace administration role/right</li><li>Have an existing SQL Warehouse on the Databricks Workspace (so users can run SQL queries on Databricks)</li></ul><p>For the creation of the group and the user, the following actions must be done at the Databricks Account level:</p><ol><li>Create a user named <code>john.do.dbx@gmail.com</code></li><li>Create a group named <code>grp_demo</code> and add the user <code>john.do.dbx@gmail.com</code> to the group <code>grp_demo</code></li></ol><p>For the user to be able to access the Databricks Workspace resources, the following actions must be done at the Databricks Workspace level:
3. Importing the <code>grp_demo</code> group into the Databricks Workspace
4. Add Databricks Workspace-level rights to the group</p><p>Actions :</p><ol><li>Step nÂ°1<ol><li>Go to <code>Account Administration page > User Management > Users</code></li><li>Click on <code>Add User</code></li><li>Fill the informations <code>Email</code>, <code>First name</code> and <code>Last name</code> and click on <code>Send invite</code></li></ol></li><li>Step nÂ°2<ol><li>Go to <code>Account Administration page > User Management > Groups</code></li><li>Click on <code>Add Group</code></li><li>Fill the information <code>Group name</code> and click on <code>save</code></li><li>Click on <code>Add members</code> to add the user <code>john.do.dbx@gmail.com</code></li></ol></li><li>Step nÂ°3<ol><li>Go to <code>Workspace page > username > Admin Settings > Groups</code></li><li>Click on <code>Add Group</code></li><li>Choose the group (from the list of existing groups at the Databricks Account level) and click on <code>Add</code></li></ol></li><li>Step nÂ°4 :<ol><li>Go to <code>Workspace page > username > Admin Settings > Groups</code></li><li>Click on the group</li><li>Click on <code>Entitlements</code><ol><li>Check the <code>Workspace access</code> option to give acces to the Databricks Workspace to all group users</li><li>Check the <code>Databricks SQL access</code> option to give acces to the SQL resources on Databricks Workspaces to all group users</li></ol></li></ol></li></ol><p>If you want to give access to a SQL Warehouse to a group, follow these steps:</p><ol><li>Go to <code>Workspace page > SQL > SQL Warehouses</code></li><li>Click on the button with 3 dots and choose the <code>Permissions</code> option</li><li>Add the groupe and choose <code>Can use</code> option</li></ol><p>Note: It is also possible to add the group at the Databricks Workspace level with the Databricks CLI tool</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4># Add a group in the Workspace Databricks (the group must exist at the Account Databricks level)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>databricks groups create --group-name <span style=color:#f1fa8c>&#34;grp_demo&#34;</span>
</span></span></code></pre></div><h1 id=rights-management>Rights management</h1><h2 id=synthesis-2>Synthesis</h2><p>Rights management is done based on the ANSI SQL syntax and more specifically with the instructions <a href=https://docs.databricks.com/sql/language-manual/security-grant.html>GRANT</a> and <a href=https://docs.databricks.com/sql/language-manual/security-revoke.html>REVOKE</a>.</p><p>You will find an exhaustive list of the rights that can be managed with Unity Catalog on the <a href=https://docs.databricks.com/sql/language-manual/sql-ref-privileges.html#privilege-types>official documentation</a></p><p>To give a right to a group or a user, the syntax is the following :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>GRANT</span> <span style=color:#ff79c6>&lt;</span>Rights <span style=color:#ff79c6>with</span> comma separator<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>ON</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>Type</span> <span style=color:#ff79c6>Object</span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>&lt;</span>Name <span style=color:#ff79c6>Object</span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>TO</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>Group</span> <span style=color:#ff79c6>or</span> <span style=color:#ff79c6>User</span><span style=color:#ff79c6>&gt;</span>;
</span></span></code></pre></div><p>To delete a right from a group or a user, the syntax is the following :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#ff79c6>REVOKE</span> <span style=color:#ff79c6>&lt;</span>Rights <span style=color:#ff79c6>with</span> comma separator<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>ON</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>Type</span> <span style=color:#ff79c6>Object</span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>&lt;</span>Name <span style=color:#ff79c6>Object</span><span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>FROM</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>Group</span> <span style=color:#ff79c6>or</span> <span style=color:#ff79c6>User</span><span style=color:#ff79c6>&gt;</span>;
</span></span></code></pre></div><p>Note: It is mandatory to have the right <code>USE/USAGE</code> on the Catalog and the Schema to access a table even if you already have the right <code>SELECT</code> on it, otherwise the user (or the group ) will not be able to see the contents of the Catalog and Schema by default.</p><p>For example: If the owner of the table <code>ctg_ext.sch_ref.tbl_demo</code> gives the right <code>SELECT</code> to the group <code>grp_demo</code> then the users of the group <code>grp_demo</code> will not be able to read the data of the table <code>tbl_demo</code> as long as they will not have the <code>USE</code> right on the Catalog <code>ctg_ext</code> and on the Schema <code>sch_ref</code>.</p><p>It is possible to manage the rights at the object (table/view) level but it is recommended to organize the data and the rights at the Schema level when the organization allows it to facilitate the management of the access rights to the different teams and profiles of the organization.</p><h2 id=practical-application-1>Practical application</h2><p>We have already created the Catalogs and Schemas with an admin account and we want to give the possibility to the user <code>john.do.dbx@gmail.com</code> to manage the objects in the different Catalogs and Schemas.</p><p>By default, the <code>grp_demo</code> group has no rights to the Metastore Catalogs (and cannot view them).</p><p>We will do the necessary actions to ensure that the rights will be sufficient to be able to perform the following manipulations:</p><ol><li>Creation of new schemas in the Catalog <code>ctg_ipp</code></li><li>Creation of tables in all Schema of Catalog <code>ctg_ipp</code> and <code>ctg_ext</code></li></ol><p>The actions to be done are the following :</p><ol><li>Give use rights on Catalogs</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4>-- Right to view the Catalog ctg_ipp
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>GRANT</span> <span style=color:#ff79c6>USAGE</span> <span style=color:#ff79c6>ON</span> <span style=color:#ff79c6>CATALOG</span> ctg_ipp <span style=color:#ff79c6>TO</span> grp_demo;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#6272a4>-- Right to view the Catalog ctg_ext
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>GRANT</span> <span style=color:#ff79c6>USAGE</span> <span style=color:#ff79c6>ON</span> <span style=color:#ff79c6>CATALOG</span> ctg_ext <span style=color:#ff79c6>TO</span> grp_demo;
</span></span></code></pre></div><ol start=2><li>Give schema creation rights at Catalog level <code>ctg_ipp</code></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4>-- Right to create new Schema in Catalog ctg_ipp
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>GRANT</span> USE <span style=color:#ff79c6>SCHEMA</span>, <span style=color:#ff79c6>CREATE</span> <span style=color:#ff79c6>SCHEMA</span> <span style=color:#ff79c6>ON</span> <span style=color:#ff79c6>CATALOG</span> ctg_ipp <span style=color:#ff79c6>TO</span> grp_demo;
</span></span></code></pre></div><ol start=3><li>Give permissions to access and create objects in the Schema <code>ctg_ext.sch_ref</code> as well as permissions to create External Tables based on the storage defined in the External Location object named <code>el_demo_data_uc</code> :</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4>-- Rights to create objects in the Schema ctg_ext.sch_ref
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>GRANT</span> USE <span style=color:#ff79c6>SCHEMA</span>, <span style=color:#ff79c6>SELECT</span> , <span style=color:#ff79c6>MODIFY</span>, <span style=color:#ff79c6>CREATE</span> <span style=color:#ff79c6>TABLE</span> <span style=color:#ff79c6>ON</span> <span style=color:#ff79c6>SCHEMA</span> ctg_ext.sch_ref <span style=color:#ff79c6>TO</span> grp_demo;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#6272a4>-- Right to create External tables with the External Location
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>GRANT</span> <span style=color:#ff79c6>CREATE</span> <span style=color:#ff79c6>EXTERNAL</span> <span style=color:#ff79c6>TABLE</span> <span style=color:#ff79c6>ON</span> <span style=color:#ff79c6>EXTERNAL</span> <span style=color:#ff79c6>LOCATION</span> <span style=color:#ff79c6>`</span>el_demo_data_uc<span style=color:#ff79c6>`</span> <span style=color:#ff79c6>TO</span> grp_demo;
</span></span></code></pre></div><ol start=4><li>Grant all rights on Schema <code>ctg_ipp.sch_bronze</code></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4>-- All privileges on the Schema ctg_ipp.sch_bronze
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>GRANT</span> <span style=color:#ff79c6>ALL</span> <span style=color:#ff79c6>PRIVILEGES</span> <span style=color:#ff79c6>ON</span> <span style=color:#ff79c6>SCHEMA</span> ctg_ipp.sch_bronze <span style=color:#ff79c6>TO</span> grp_demo;
</span></span></code></pre></div><p>If you want a user to be able to create the <code>External Location</code> object to set up access to a new AWS S3 resource, you must give him the following rights:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4>-- Right on the Metastore for the group
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>GRANT</span> <span style=color:#ff79c6>CREATE</span> <span style=color:#ff79c6>EXTERNAL</span> <span style=color:#ff79c6>LOCATION</span> <span style=color:#ff79c6>ON</span> METASTORE <span style=color:#ff79c6>TO</span> grp_demo;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#6272a4>-- Right on the Storage Credential to the group
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>GRANT</span> <span style=color:#ff79c6>CREATE</span> <span style=color:#ff79c6>EXTERNAL</span> <span style=color:#ff79c6>LOCATION</span> <span style=color:#ff79c6>ON</span> <span style=color:#ff79c6>STORAGE</span> CREDENTIAL <span style=color:#ff79c6>`</span>sc<span style=color:#ff79c6>-</span>demo<span style=color:#ff79c6>-</span><span style=color:#ff79c6>data</span><span style=color:#ff79c6>-</span>uc<span style=color:#ff79c6>`</span> <span style=color:#ff79c6>TO</span> grp_demo;
</span></span></code></pre></div><p>Example of queries to retrieve all the rights given to the <code>grp_demo</code> group on the objects of the Catalog <code>ctg_ipp</code> and <code>ctg_ext</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>-- How to get all the existing privileges for a group ?
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4>-- Get privileges from Catalog
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>select</span> <span style=color:#f1fa8c>&#39;GRANT &#39;</span><span style=color:#ff79c6>||</span><span style=color:#ff79c6>replace</span>(privilege_type,<span style=color:#f1fa8c>&#39;_&#39;</span>,<span style=color:#f1fa8c>&#39; &#39;</span>)<span style=color:#ff79c6>||</span><span style=color:#f1fa8c>&#39; ON CATALOG &#39;</span><span style=color:#ff79c6>||</span><span style=color:#ff79c6>catalog_name</span><span style=color:#ff79c6>||</span><span style=color:#f1fa8c>&#39; TO &#39;</span><span style=color:#ff79c6>||</span>grantee<span style=color:#ff79c6>||</span><span style=color:#f1fa8c>&#39;;&#39;</span> <span style=color:#ff79c6>as</span> grant_query
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#ff79c6>from</span> <span style=color:#ff79c6>system</span>.INFORMATION_SCHEMA.CATALOG_PRIVILEGES
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#ff79c6>where</span> grantee<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;grp_demo&#39;</span> 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    <span style=color:#ff79c6>and</span> grantor <span style=color:#ff79c6>&lt;&gt;</span> <span style=color:#f1fa8c>&#39;System user&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    <span style=color:#ff79c6>and</span> <span style=color:#ff79c6>catalog_name</span> <span style=color:#ff79c6>in</span> (<span style=color:#f1fa8c>&#39;ctg_ipp&#39;</span>,<span style=color:#f1fa8c>&#39;ctg_ext&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>    <span style=color:#ff79c6>and</span> inherited_from <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;NONE&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#ff79c6>order</span> <span style=color:#ff79c6>by</span> <span style=color:#ff79c6>catalog_name</span>,privilege_type
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#6272a4>-- Get privileges from Schema
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>select</span> <span style=color:#f1fa8c>&#39;GRANT &#39;</span><span style=color:#ff79c6>||</span><span style=color:#ff79c6>replace</span>(privilege_type,<span style=color:#f1fa8c>&#39;_&#39;</span>,<span style=color:#f1fa8c>&#39; &#39;</span>)<span style=color:#ff79c6>||</span><span style=color:#f1fa8c>&#39; ON SCHEMA &#39;</span><span style=color:#ff79c6>||</span><span style=color:#ff79c6>catalog_name</span><span style=color:#ff79c6>||</span><span style=color:#f1fa8c>&#39;.&#39;</span><span style=color:#ff79c6>||</span><span style=color:#ff79c6>schema_name</span><span style=color:#ff79c6>||</span><span style=color:#f1fa8c>&#39; TO &#39;</span><span style=color:#ff79c6>||</span>grantee<span style=color:#ff79c6>||</span><span style=color:#f1fa8c>&#39;;&#39;</span> <span style=color:#ff79c6>as</span> grant_query
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#ff79c6>from</span> <span style=color:#ff79c6>system</span>.INFORMATION_SCHEMA.SCHEMA_PRIVILEGES
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#ff79c6>where</span> grantee<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;grp_demo&#39;</span> 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>  <span style=color:#ff79c6>and</span> grantor <span style=color:#ff79c6>&lt;&gt;</span> <span style=color:#f1fa8c>&#39;System user&#39;</span> 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>  <span style=color:#ff79c6>and</span> <span style=color:#ff79c6>catalog_name</span> <span style=color:#ff79c6>in</span> (<span style=color:#f1fa8c>&#39;ctg_ipp&#39;</span>,<span style=color:#f1fa8c>&#39;ctg_ext&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>  <span style=color:#ff79c6>and</span> inherited_from <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;NONE&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#ff79c6>order</span> <span style=color:#ff79c6>by</span> <span style=color:#ff79c6>catalog_name</span>, <span style=color:#ff79c6>schema_name</span>,privilege_type;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#6272a4>-- Get privileges from Table
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>select</span> <span style=color:#f1fa8c>&#39;GRANT &#39;</span><span style=color:#ff79c6>||</span><span style=color:#ff79c6>replace</span>(privilege_type,<span style=color:#f1fa8c>&#39;_&#39;</span>,<span style=color:#f1fa8c>&#39; &#39;</span>)<span style=color:#ff79c6>||</span><span style=color:#f1fa8c>&#39; ON TABLE &#39;</span><span style=color:#ff79c6>||</span>table_catalog<span style=color:#ff79c6>||</span><span style=color:#f1fa8c>&#39;.&#39;</span><span style=color:#ff79c6>||</span>table_schema<span style=color:#ff79c6>||</span><span style=color:#f1fa8c>&#39;.&#39;</span><span style=color:#ff79c6>||</span><span style=color:#ff79c6>table_name</span><span style=color:#ff79c6>||</span><span style=color:#f1fa8c>&#39; TO &#39;</span><span style=color:#ff79c6>||</span>grantee<span style=color:#ff79c6>||</span><span style=color:#f1fa8c>&#39;;&#39;</span>  <span style=color:#ff79c6>as</span> grant_query
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#ff79c6>from</span> <span style=color:#ff79c6>system</span>.INFORMATION_SCHEMA.TABLE_PRIVILEGES
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#ff79c6>where</span> grantee <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;grp_demo&#39;</span> 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>  <span style=color:#ff79c6>and</span> grantor <span style=color:#ff79c6>&lt;&gt;</span> <span style=color:#f1fa8c>&#39;System user&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>  <span style=color:#ff79c6>and</span> table_catalog <span style=color:#ff79c6>in</span> (<span style=color:#f1fa8c>&#39;ctg_ipp&#39;</span>,<span style=color:#f1fa8c>&#39;ctg_ext&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>  <span style=color:#ff79c6>and</span> inherited_from <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;NONE&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span><span style=color:#ff79c6>order</span> <span style=color:#ff79c6>by</span> table_catalog,table_schema,<span style=color:#ff79c6>table_name</span>,privilege_type;
</span></span></code></pre></div><h1 id=storage-management>Storage management</h1><h2 id=synthesis-3>Synthesis</h2><p>The Table object is used to define the structure and storage of data.</p><p>Tables and views must be created in a Schema.</p><p>By default, if nothing is specified when creating the Catalog and Schema objects, all the data will be managed by Unity Catalog based on the storage (AWS S3 resource) defined at the Metastore level.
If the <code>MANAGED LOCATION</code> option is defined at the Catalog level then all the children elements (Schema and Table) will use this default storage option instead of the storage defined at the Metastore level.
If the <code>MANAGED LOCATION</code> option is defined at the Schema level then all the children elements (Table) will use this default storage option instead of the storage defined at the Metastore level.</p><p>Syntax example :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>-- Catalog creation
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>CREATE</span> <span style=color:#ff79c6>CATALOG</span> XXX
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    MANAGED <span style=color:#ff79c6>LOCATION</span> <span style=color:#f1fa8c>&#39;s3://YYYYYYYYY&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#ff79c6>COMMENT</span> <span style=color:#f1fa8c>&#39;ZZZZZZZZ&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4>-- Schema creation
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>CREATE</span> <span style=color:#ff79c6>SCHEMA</span> XXX
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>    MANAGED <span style=color:#ff79c6>LOCATION</span> <span style=color:#f1fa8c>&#39;s3://YYYYYYYYY&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>    <span style=color:#ff79c6>COMMENT</span> <span style=color:#f1fa8c>&#39;ZZZZZZZZ&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>;
</span></span></code></pre></div><p>Schema and Catalog are just logical container for organizing data.
There is no directory creation when creating these objects.</p><p>There are two types of tables:</p><ul><li>Managed Table: Metadata and data are managed by Unity Catalog and the storage format used is the Delta format.</li><li>External Table: Only metadata is managed by Unity Catalog. The storage format can be one of the following formats &ldquo;Delta, CSV, JSON, Avro, Parquet, ORC or Text&rdquo;</li></ul><p>Regarding Managed Table:</p><ul><li>When a Managed Table is created, the data is created in a sub-directory of the storage defined at the Metastore level (in the case where the &ldquo;MANAGED LOCATION&rdquo; option is not defined at the Catalog or parent Schema level )</li><li>The path will be the following <code>&lt;Metastore S3 Path>/&lt;Metastore ID>/tables/&lt;table ID></code>,<ul><li>Example: <code>s3://s3-dbx-metastore-uc/metastore-sandbox/13a746fa-c056-4b32-b6db-9d31c0d1eecf/tables/5c725019-fe8f-4778-a97c-c640eaf9b13e</code><ul><li>Metastore S3 Path: <code>s3-dbx-metastore-uc</code></li><li>Metastore ID: <code>13a746fa-c056-4b32-b6db-9d31c0d1eecf</code></li><li>Table ID: <code>5c725019-fe8f-4778-a97c-c640eaf9b13e</code></li></ul></li><li>From the storage point of view, all the managed tables at the Metastore level will be found by default in the <code>tables/</code> directory with a unique identifier defined when they are created.</li></ul></li><li>When deleting the table, metadata as well as data (files) will be deleted</li></ul><p>Regarding the External Table :</p><ul><li><p>When creating an External Table, you must define the data full access path (Unity Catalog manages rights based on a Storace Credential object and an External Location object)</p><ul><li>If files already exist, the definition of the table (source data format, schema, etc.) must be compatible with the existing data</li><li>If no file exists, the Delta format log elements will be created in the <code>_log_delta</code> subdirectory of the defined path and the data files will be created when adding data to the table</li></ul></li><li><p>When deleting the table, only metadata is deleted. The data (files) are not impacted by the deletion.</p></li><li><p>Some limitations:</p><ul><li>If the table is based on a csv file, no action other than reading will be allowed</li><li>If the table is based from data (files) in CSV format (or other format outside Delta) (written by spark processing for example), it will be possible to make insert but not update or delete</li><li>If the table is based from data in Delta format then it will be possible to do exactly the same actions as with a Managed Table</li><li>It is not possible to define two different external tables using exactly the same data files path as external storage</li></ul></li></ul><h2 id=practical-application-2>Practical application</h2><p>Creating an External Table and a Managed Table :</p><ol><li>Creation of an External Table named <code>ref_products</code> in the Schema <code>sch_ref</code> of the Catalog <code>ctg_ext</code> from a csv file named <code>ref_products.csv</code></li><li>Creation of an Managed Table named <code>fct_transactions</code> in the Schema <code>sch_bronze</code> of the Catalog <code>ctg_ipp</code></li><li>Insertion of data into the <code>fct_transactions</code> table from a CSV file named <code>fct_transactions.csv</code></li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>-- 1. Creation of external table ref_products
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>CREATE</span> <span style=color:#ff79c6>TABLE</span> ctg_ext.sch_ref.ref_products (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    id <span style=color:#8be9fd;font-style:italic>int</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    ,lib string
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    ,brand string
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>    ,os string
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>    ,last_maj <span style=color:#ff79c6>timestamp</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#ff79c6>USING</span> CSV
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#ff79c6>OPTIONS</span> (path <span style=color:#f1fa8c>&#34;s3://s3-demo-data-uc/demo/ref_products.csv&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>        <span style=color:#ff79c6>delimiter</span> <span style=color:#f1fa8c>&#34;,&#34;</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>        header <span style=color:#f1fa8c>&#34;true&#34;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#ff79c6>COMMENT</span> <span style=color:#f1fa8c>&#39;Product referential (external)&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#6272a4>-- 2. Creation of managed table fct_transactions
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>CREATE</span> <span style=color:#ff79c6>TABLE</span> ctg_ipp.sch_bronze.fct_transactions (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>    id_trx string
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>    ,ts_trx string
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span>    ,id_product string
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>    ,id_shop string
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>    ,id_client string
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>    ,quantity string
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span><span style=color:#ff79c6>COMMENT</span> <span style=color:#f1fa8c>&#39;Bronze Transactions Data&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span><span style=color:#6272a4>-- 3. Insert data from CSV files into the fct_transactions table
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>COPY</span> <span style=color:#ff79c6>INTO</span> ctg_ipp.sch_bronze.fct_transactions
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>  <span style=color:#ff79c6>FROM</span> <span style=color:#f1fa8c>&#39;s3://s3-demo-data-uc/demo/fct_transactions.csv&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span>  FILEFORMAT <span style=color:#ff79c6>=</span> CSV
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span>  FORMAT_OPTIONS (<span style=color:#f1fa8c>&#39;encoding&#39;</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;utf8&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span>                ,<span style=color:#f1fa8c>&#39;inferSchema&#39;</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;false&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>                ,<span style=color:#f1fa8c>&#39;nullValue&#39;</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;N/A&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>                ,<span style=color:#f1fa8c>&#39;mergeSchema&#39;</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;false&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>                ,<span style=color:#f1fa8c>&#39;delimiter&#39;</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;,&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>                ,<span style=color:#f1fa8c>&#39;header&#39;</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;true&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>                ,<span style=color:#f1fa8c>&#39;mode&#39;</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;failfast&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>;
</span></span></code></pre></div><p>Example of an error when updating data from an External Table based on a CSV file
4. Updating <code>ref_products</code> table data in error
5. Deleting data from the <code>ref_products</code> table in error</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4>-- 4. Error : Try to update the data in the ref_products table
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>UPDATE</span> ctg_ext.sch_ref.ref_products
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#ff79c6>SET</span> last_maj <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>current_timestamp</span>()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#ff79c6>WHERE</span> id <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#6272a4>-- Result : UPDATE destination only supports Delta sources
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#6272a4></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#6272a4>-- 5. Error : Try to delete the data from ref_products table
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>DELETE</span> <span style=color:#ff79c6>FROM</span> ctg_ext.sch_ref.ref_products
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#ff79c6>WHERE</span> id <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#6272a4>-- Result : Could not verify permissions for DeleteFromTable
</span></span></span></code></pre></div><p>Example of data storage management for an External Table (in Delta format) when it is created and deleted:
6. Creating an external table with the <code>appendOnly</code> property
7. Checking the list of files on the AWS S3 resource
8. Inserting data through the Metastore Unity Catalog
9. Checking the list of files on the AWS S3 resource
10. Reading the Delta Data History
11. Deleting data without using the Metastore Unity Catalog table (the <code>appendOnly</code> property blocks the execution of this action)
12. Deleting the external table
13. Checking existence of files with S3</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#6272a4>-- 6. Create an external table named &#34;ext_tbl&#34; in schema &#34;ctg_ext.sch_ref&#34; in the location &#34;s3://s3-demo-data-uc/demo/ext_tbl&#34; with the delta properties &#34;appendOnly&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>CREATE</span> <span style=color:#ff79c6>TABLE</span> ctg_ext.sch_ref.ext_tbl (
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    col1 <span style=color:#8be9fd;font-style:italic>int</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>    ,col2 <span style=color:#ff79c6>timestamp</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#ff79c6>COMMENT</span> <span style=color:#f1fa8c>&#39;Test External Table with TBLProperties&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#ff79c6>LOCATION</span> <span style=color:#f1fa8c>&#39;s3://s3-demo-data-uc/demo/ext_tbl&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>TBLPROPERTIES(<span style=color:#f1fa8c>&#39;delta.appendOnly&#39;</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;true&#39;</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#6272a4>-- 7. Check if the file exists on AWS S3 (with AWS CLI)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#6272a4>-- aws s3 ls s3://s3-demo-data-uc/demo/ --recursive | grep &#34;ext_tbl&#34; | sed &#39;s/[[:space:]][[:space:]]*/|/g&#39; | cut -d &#34;|&#34; -f 4
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#6272a4></span><span style=color:#6272a4>/* Result : 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#6272a4>demo/ext_tbl/_delta_log/
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#6272a4>demo/ext_tbl/_delta_log/.s3-optimization-0
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#6272a4>demo/ext_tbl/_delta_log/.s3-optimization-1
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#6272a4>demo/ext_tbl/_delta_log/.s3-optimization-2
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#6272a4>demo/ext_tbl/_delta_log/00000000000000000000.crc
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#6272a4>demo/ext_tbl/_delta_log/00000000000000000000.json
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#6272a4>*/</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#6272a4>-- 8. Insert Data into the &#34;ext_tbl&#34; table
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>INSERT</span> <span style=color:#ff79c6>INTO</span> ctg_ext.sch_ref.ext_tbl <span style=color:#ff79c6>VALUES</span> (<span style=color:#bd93f9>1</span>,<span style=color:#ff79c6>current_timestamp</span>());
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span><span style=color:#6272a4>-- 9. Check if the file exists on AWS S3 (with AWS CLI)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span><span style=color:#6272a4>-- aws s3 ls s3://s3-demo-data-uc/demo/ --recursive | grep &#34;ext_tbl&#34; | sed &#39;s/[[:space:]][[:space:]]*/|/g&#39; | cut -d &#34;|&#34; -f 4
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span><span style=color:#6272a4></span><span style=color:#6272a4>/* Result : 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span><span style=color:#6272a4>demo/ext_tbl/_delta_log/
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span><span style=color:#6272a4>demo/ext_tbl/_delta_log/.s3-optimization-0
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span><span style=color:#6272a4>demo/ext_tbl/_delta_log/.s3-optimization-1
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span><span style=color:#6272a4>demo/ext_tbl/_delta_log/.s3-optimization-2
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span><span style=color:#6272a4>demo/ext_tbl/_delta_log/00000000000000000000.crc
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span><span style=color:#6272a4>demo/ext_tbl/_delta_log/00000000000000000000.json
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span><span style=color:#6272a4>demo/ext_tbl/_delta_log/00000000000000000001.crc
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span><span style=color:#6272a4>demo/ext_tbl/_delta_log/00000000000000000001.json
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span><span style=color:#6272a4>demo/ext_tbl/part-00000-097fb1f5-1d7e-464a-a65b-1303bd06e2b0.c000.snappy.parquet
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span><span style=color:#6272a4>*/</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span><span style=color:#6272a4>-- 10. Check Delta History
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>DESCRIBE</span> HISTORY ctg_ext.sch_ref.ext_tbl;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span><span style=color:#6272a4>/* Result : 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span><span style=color:#6272a4>Version 1 : WRITE
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span><span style=color:#6272a4>Version 0 : CREATE TABLE
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span><span style=color:#6272a4>*/</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span><span style=color:#6272a4>-- 11. Delete data without using the Unity Catalog Table
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>DELETE</span> <span style=color:#ff79c6>FROM</span> DELTA.<span style=color:#ff79c6>`</span>s3:<span style=color:#ff79c6>//</span>s3<span style=color:#ff79c6>-</span>demo<span style=color:#ff79c6>-</span><span style=color:#ff79c6>data</span><span style=color:#ff79c6>-</span>uc<span style=color:#ff79c6>/</span>demo<span style=color:#ff79c6>/</span>ext_tbl<span style=color:#ff79c6>`</span> <span style=color:#ff79c6>WHERE</span> col1 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span><span style=color:#6272a4>/* Result : This table is configured to only allow appends.*/</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54</span><span><span style=color:#6272a4>-- 12. Delete the table &#34;ext_tbl&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>DROP</span> <span style=color:#ff79c6>TABLE</span> ctg_ext.sch_ref.ext_tbl;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57</span><span><span style=color:#6272a4>-- 13. Check if the file exists on AWS S3 (with AWS CLI)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58</span><span><span style=color:#6272a4>-- aws s3 ls s3://s3-demo-data-uc/demo/ --recursive | grep &#34;ext_tbl&#34; | sed &#39;s/[[:space:]][[:space:]]*/|/g&#39; | cut -d &#34;|&#34; -f 4
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59</span><span><span style=color:#6272a4></span><span style=color:#6272a4>/* Result : 
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60</span><span><span style=color:#6272a4>demo/ext_tbl/_delta_log/
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61</span><span><span style=color:#6272a4>demo/ext_tbl/_delta_log/.s3-optimization-0
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62</span><span><span style=color:#6272a4>demo/ext_tbl/_delta_log/.s3-optimization-1
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63</span><span><span style=color:#6272a4>demo/ext_tbl/_delta_log/.s3-optimization-2
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64</span><span><span style=color:#6272a4>demo/ext_tbl/_delta_log/00000000000000000000.crc
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65</span><span><span style=color:#6272a4>demo/ext_tbl/_delta_log/00000000000000000000.json
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66</span><span><span style=color:#6272a4>demo/ext_tbl/_delta_log/00000000000000000001.crc
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67</span><span><span style=color:#6272a4>demo/ext_tbl/_delta_log/00000000000000000001.json
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68</span><span><span style=color:#6272a4>demo/ext_tbl/part-00000-097fb1f5-1d7e-464a-a65b-1303bd06e2b0.c000.snappy.parquet
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">69</span><span><span style=color:#6272a4>*/</span>
</span></span></code></pre></div><p>Remarks :</p><ul><li>When creating a table, only the <code>_delta_log</code> subdirectory is created to contain the information of version nÂ°0</li><li>When defining a property with the âTBLPROPERTIESâ option on the external table, it is also saved on the storage.</li><li>After deleting the table, the data is no longer accessible through the table but is still accessible through the AWS S3 resource path</li></ul><p>Regarding the properties that can be used with the Delta format:
You can find more information in the <a href=https://docs.databricks.com/sql/language-manual/sql-ref-syntax-ddl-tblproperties.html>official documentation</a></p><h1 id=clean-environment>Clean environment</h1><p>You will find, below, all the instructions needed to clean the environment.</p><p>Drop elements from Unity Catalog using SQL statements:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4>-- Delete the Catalog with CASCADE option (to delete all objects)
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>DROP</span> <span style=color:#ff79c6>CATALOG</span> <span style=color:#ff79c6>IF</span> <span style=color:#ff79c6>EXISTS</span> ctg_ipp <span style=color:#ff79c6>CASCADE</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3</span><span><span style=color:#ff79c6>DROP</span> <span style=color:#ff79c6>CATALOG</span> <span style=color:#ff79c6>IF</span> <span style=color:#ff79c6>EXISTS</span> ctg_ext <span style=color:#ff79c6>CASCADE</span>;
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5</span><span><span style=color:#6272a4>-- Delete the External Location
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6</span><span><span style=color:#6272a4></span><span style=color:#ff79c6>DROP</span> <span style=color:#ff79c6>EXTERNAL</span> <span style=color:#ff79c6>LOCATION</span> <span style=color:#ff79c6>IF</span> <span style=color:#ff79c6>EXISTS</span> el_demo_data_uc <span style=color:#ff79c6>force</span>;
</span></span></code></pre></div><p>Note regarding the removal of the <code>External Location</code> object:</p><ul><li>Must be the owner</li><li>It must not already be used by a table, otherwise you must use the <code>force</code> option</li></ul><p>Deleting data used on the AWS S3 resource:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1</span><span><span style=color:#6272a4># Delete all files stored in the AWS S3 resource</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2</span><span>aws s3 rm <span style=color:#f1fa8c>&#34;s3://s3-demo-data-uc/demo/&#34;</span> --recursive 
</span></span></code></pre></div><p>Deleting the group from the Databricks Account (this will automatically delete the group at the Databricks Workspace level):</p><ol><li>Go to <code>Account Databricks page > User management > Groups</code></li><li>Use the search bar to find the desired group</li><li>Click on the button with the 3 dots associated with the group and choose the <code>Delete</code> option</li><li>Click on <code>Confirm Delete</code></li></ol><p>Deleting the user at the Databricks Account level:</p><ol><li>Go to <code>Account Databricks page > User management > Users</code></li><li>Use the search bar to find the desired user</li><li>Click on the user&rsquo;s name</li><li>Click on the button with the 3 dots and choose the <code>Delete user</code> option</li><li>Click on <code>Confirm Delete</code></li></ol><h1 id=conclusion>Conclusion</h1><p>We were able to see a first overview of some features of the Unity Catalog solution, mainly concerning the management of rights and storage with External Table and Managed Table.</p><p>Rights management is simplified by the use of ANSI SQL syntax, the use of user groups and the centralization of access management within Unity Catalog..</p><p>Group management requires being an Administrator on the Databricks Account (creation and deletion of groups, addition and deletion of users in groups) and an Administrator on the Databricks Workspace to add or delete existing groups at the level of the Databricks Account in the Databricks Workspace.</p><p>Warning : The management of rights and groups are not compatible between Unity Catalog and Hive Metastore, it is recommended to migrate the elements from Hive Metastore to Unity Catalog by recreating the necessary elements.</p><p>If you want to implement an open data lake by minimizing the use of Databricks, it is possible to use Unity Catalog with external tables in Delta format to be able to use the maximum functionality while using other tools to directly access Delta data (AWS EMR, AWS Glue, AWS Athena, &mldr;).</p><p>However, if you wish to use the Unity Catalog solution, it is strongly recommended to centralize all data governance in order to be able to manage all access within the Unity Catalog solution.</p><p>From the Unity Catalog solution, it is possible to access the data using Clusters, SQL Warehouse or the Delta Sharing functionality to multiply the usage of the data.</p><h1 id=resources>Resources</h1><h2 id=creation-of-a-sql-warehouse>Creation of a SQL Warehouse</h2><p>Databricks CLI does not support managing SQL Warehouses at the moment, therefore we can use <a href=https://docs.databricks.com/sql/api/sql-endpoints.html>Databricks REST API</a> to do it.</p><p>Prerequisites :</p><ul><li>Have the <code>Curl</code> tool installed</li></ul><p>Actions:</p><ol><li>Creation of a <code>.netrc</code> file to manage access to the REST API:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4># Create the folder where the .netrc file will be stored</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>mkdir ~/.databricks
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4># Create the .netrc file</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;machine &lt;url workspace databricks without https://&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#f1fa8c>login token
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#f1fa8c>password &lt;token user databricks&gt;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#f1fa8c>&#34;</span> &gt; ~/.databricks/.netrc
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4># Create an alias to use the tool curl with .netrc file</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;alias dbx-api=&#39;curl --netrc-file ~/.databricks/.netrc&#39;&#34;</span> &gt;&gt; ~/.alias 
</span></span></code></pre></div><ol start=2><li>Creation of a warehouse</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>DBX_API_URL</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;&lt;url workspace databricks&gt;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4># Get the list of the existing SQL Warehouses (check if the SQL Warehouse exists)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>dbx-api -X GET <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>DBX_API_URL</span><span style=color:#f1fa8c>}</span>/api/2.0/sql/warehouses/ | jq .
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4># Create the temporary config file for the SQL Warehouse</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>cat &gt; tmp_databricks_create_warehouse.json <span style=color:#f1fa8c>&lt;&lt;EOF
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span><span style=color:#f1fa8c>{
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#f1fa8c>  &#34;name&#34;: &#34;DEMO_WH_XXS&#34;,
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span><span style=color:#f1fa8c>  &#34;cluster_size&#34;: &#34;2X-Small&#34;,
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#f1fa8c>  &#34;min_num_clusters&#34;: 1,
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#f1fa8c>  &#34;max_num_clusters&#34;: 1,
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#f1fa8c>  &#34;auto_stop_mins&#34;: 20,
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span><span style=color:#f1fa8c>  &#34;auto_resume&#34;: true,
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#f1fa8c>  &#34;tags&#34;: {
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#f1fa8c>    &#34;custom_tags&#34;: [
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#f1fa8c>      {
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span><span style=color:#f1fa8c>        &#34;key&#34;: &#34;owner&#34;,
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span><span style=color:#f1fa8c>        &#34;value&#34;: &#34;admin@tech.demo&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#f1fa8c>      },
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span><span style=color:#f1fa8c>      {
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#f1fa8c>        &#34;key&#34;: &#34;project&#34;,
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#f1fa8c>        &#34;value&#34;: &#34;databricks-demo&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span><span style=color:#f1fa8c>      }
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span><span style=color:#f1fa8c>    ]
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span><span style=color:#f1fa8c>  },
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span><span style=color:#f1fa8c>  &#34;spot_instance_policy&#34;:&#34;COST_OPTIMIZED&#34;,
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span><span style=color:#f1fa8c>  &#34;enable_photon&#34;: &#34;true&#34;,
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span><span style=color:#f1fa8c>  &#34;enable_serverless_compute&#34;: &#34;false&#34;,
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span><span style=color:#f1fa8c>  &#34;warehouse_type&#34;: &#34;CLASSIC&#34;,
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span><span style=color:#f1fa8c>  &#34;channel&#34;: {
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span><span style=color:#f1fa8c>    &#34;name&#34;: &#34;CHANNEL_NAME_CURRENT&#34;
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span><span style=color:#f1fa8c>  }
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span><span style=color:#f1fa8c>}
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span><span style=color:#f1fa8c>EOF</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span><span style=color:#6272a4># Creation of the SQL Warehouse</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>dbx-api -X POST -H <span style=color:#f1fa8c>&#34;Content-Type: application/json&#34;</span> -d <span style=color:#f1fa8c>&#34;@tmp_databricks_create_warehouse.json&#34;</span> <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>DBX_API_URL</span><span style=color:#f1fa8c>}</span>/api/2.0/sql/warehouses/ 
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span><span style=color:#6272a4># Delete the temporary config file</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span>rm tmp_databricks_create_warehouse.json
</span></span></code></pre></div><p>Some actions that may be useful :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#6272a4># Export the SQL Warehouse ID</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#8be9fd;font-style:italic>export</span> <span style=color:#8be9fd;font-style:italic>SQL_WH_ID</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;&lt;SQL Warehouse ID&gt;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#6272a4># Check the state of the SQL Warehouse</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>dbx-api -X GET <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>DBX_API_URL</span><span style=color:#f1fa8c>}</span>/api/2.0/sql/warehouses/<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>SQL_WH_ID</span><span style=color:#f1fa8c>}</span> | jq <span style=color:#f1fa8c>&#39;.state&#39;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#6272a4># Stop the SQL Warehouse (by default, it starts at creation)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>dbx-api -X POST <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>DBX_API_URL</span><span style=color:#f1fa8c>}</span>/api/2.0/sql/warehouses/<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>SQL_WH_ID</span><span style=color:#f1fa8c>}</span>/stop
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#6272a4># Start the SQL Warehouse</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>dbx-api -X POST <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>DBX_API_URL</span><span style=color:#f1fa8c>}</span>/api/2.0/sql/warehouses/<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>SQL_WH_ID</span><span style=color:#f1fa8c>}</span>/start
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#6272a4># Delete the SQL Warehouse</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>dbx-api -X DELETE <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>DBX_API_URL</span><span style=color:#f1fa8c>}</span>/api/2.0/sql/warehouses/<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>SQL_WH_ID</span><span style=color:#f1fa8c>}</span>
</span></span></code></pre></div></div></article></div></div><footer><div class="container-fluid prag-bg-primary prag-foot">Build With <a href=https://gohugo.io/>Hugo</a>
&nbsp; - &nbsp;
<a href=https://en.wikipedia.org/wiki/WTFPL>WTFPL license</a> Â© 2018â2023</div></footer></body></html>