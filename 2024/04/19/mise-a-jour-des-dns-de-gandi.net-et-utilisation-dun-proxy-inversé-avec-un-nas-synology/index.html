<!doctype html><html lang=fr><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta charset=utf-8><meta name=robots content="noindex, nofollow, noarchive, nosnipper, noodp, noydir"><meta name=google content="notranslate, noimageindex"><meta name=slurp content="notranslate, noimageindex"><meta name=msnbot content="notranslate, noimageindex"><meta name=bingbot content="notranslate, noimageindex"><meta name=generator content="Hugo 0.129.0"><link rel=stylesheet href=https://www.pragmatias.fr//css/bootstrap.min.css><link rel=stylesheet href=https://www.pragmatias.fr//css/pragmatias.css><script src=https://www.pragmatias.fr//js/jquery-3.6.0.slim.min.js></script><script src=https://www.pragmatias.fr//js/popper.min.js></script><script src=https://www.pragmatias.fr//js/bootstrap.bundle.min.js></script><link rel=alternate type=application/rss+xml href=https://www.pragmatias.fr/feed.xml><title>Mise a jour des DNS de Gandi.net et utilisation d'un Proxy inversé avec un NAS Synology</title><body><div class="navbar navbar-expand-md prag-bg-primary prag-header" role=navigation><div class="container-fluid justify-content-center"><div class=navbar-brand><a href=https://www.pragmatias.fr/blog/><img src=/images/logo_pragmatias.svg alt=pragmatias></a></div><button class="navbar-toggler justify-content-end prag-navbar" type=button data-toggle=collapse data-target=#navbarSupportedContent1,#navbarSupportedContent2 aria-controls=navbarSupportedContent1 aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent1><ul class="navbar-nav text-center"><li class=nav-item><a class=nav-link href=https://www.pragmatias.fr/blog/>Blog</a></li><li class=nav-item><a class=nav-link href=https://www.pragmatias.fr/tags/>Tags</a></li><li class=nav-item><a class=nav-link href=https://www.pragmatias.fr/archives/>Archives</a></li></ul></div><div class="collapse navbar-collapse justify-content-md-end" id=navbarSupportedContent2><ul class="navbar-nav flex-row justify-content-center"><li class=nav-item><a href=https://www.pragmatias.fr/en/2024/04/19/updating-gandi.net-dns-and-using-a-reverse-proxy-with-a-synology-nas/ class="prag_header_svg mr-1 ml-1"><img src=/images/united-kingdom-flag-round-xs-24.png alt=English></a></li><li class=nav-item><a href=https://www.pragmatias.fr/feed.xml title="Pragmatias Blog" class="prag_header_svg mr-1 ml-1"><svg height="24" style="enable-background:new 0 0 508.52 508.52" viewBox="0 0 508.52 508.52" width="24" xmlns:xlink="http://www.w3.org/1999/xlink"><path style="fill-rule:evenodd;clip-rule:evenodd;fill:" d="M254.26.0C113.845.0.0 113.845.0 254.26s113.845 254.26 254.26 254.26 254.26-113.845 254.26-254.26C508.52 113.813 394.675.0 254.26.0zM137.141 412.441c-22.852.0-41.413-18.434-41.413-41.285.0-22.693 18.561-41.349 41.413-41.349 22.915.0 41.444 18.656 41.476 41.349C178.618 393.976 160.088 412.441 137.141 412.441zM241.197 412.791c0-39.029-15.16-75.674-42.62-103.071-27.46-27.524-63.978-42.716-102.785-42.716V207.38c113.177.0 205.315 92.137 205.315 205.41h-59.91zM347.001 412.727c0-138.603-112.669-251.399-251.145-251.399v-59.624c171.435.0 310.96 139.589 310.96 311.023H347.001z"/></svg></a></li><li class=nav-item><a href=mailto:contact@pragmatias.fr title=Mail class="prag_header_svg mr-1 ml-1"><svg height="24" style="enable-background:new 0 0 299.997 299.997" viewBox="0 0 299.997 299.997" width="24" xmlns:xlink="http://www.w3.org/1999/xlink"><path style="fill-rule:evenodd;clip-rule:evenodd;fill:" d="M149.996.0C67.157.0.001 67.158.001 149.997c0 82.837 67.156 150 149.995 150s150-67.163 150-150C299.996 67.158 232.835.0 149.996.0zM149.999 52.686l88.763 55.35H61.236l88.763-55.35zm89.869 143.737h-.009c0 8.878-7.195 16.072-16.072 16.072H76.211c-8.878.0-16.072-7.195-16.072-16.072v-84.865c0-.939.096-1.852.252-2.749l84.808 52.883c.104.065.215.109.322.169.112.062.226.122.34.179.599.309 1.216.558 1.847.721.065.018.13.026.195.041.692.163 1.393.265 2.093.265h.005c.005.0.01.0.01.0.7.0 1.401-.099 2.093-.265.065-.016.13-.023.195-.041.63-.163 1.245-.412 1.847-.721.114-.057.228-.117.34-.179.106-.06.218-.104.322-.169l84.808-52.883c.156.897.252 1.808.252 2.749v84.865z"/></svg></a></li><li><a href=https://github.com/pragmatias/ title=github class="prag_header_svg mr-1 ml-1"><svg height="24" style="enable-background:new 0 0 438.549 438.549" viewBox="0 0 438.549 438.549" width="24" xmlns:xlink="http://www.w3.org/1999/xlink"><path style="fill-rule:evenodd;clip-rule:evenodd;fill:" d="M409.132 114.573c-19.608-33.596-46.205-60.194-79.798-79.8C295.736 15.166 259.057 5.365 219.271 5.365c-39.781.0-76.472 9.804-110.063 29.408-33.596 19.605-60.192 46.204-79.8 79.8C9.803 148.168.0 184.854.0 224.63c0 47.78 13.94 90.745 41.827 128.906 27.884 38.164 63.906 64.572 108.063 79.227 5.14.954 8.945.283 11.419-1.996 2.475-2.282 3.711-5.14 3.711-8.562.0-.571-.049-5.708-.144-15.417-.098-9.709-.144-18.179-.144-25.406l-6.567 1.136c-4.187.767-9.469 1.092-15.846 1-6.374-.089-12.991-.757-19.842-1.999-6.854-1.231-13.229-4.086-19.13-8.559-5.898-4.473-10.085-10.328-12.56-17.556l-2.855-6.57c-1.903-4.374-4.899-9.233-8.992-14.559-4.093-5.331-8.232-8.945-12.419-10.848l-1.999-1.431c-1.332-.951-2.568-2.098-3.711-3.429-1.142-1.331-1.997-2.663-2.568-3.997-.572-1.335-.098-2.43 1.427-3.289s4.281-1.276 8.28-1.276l5.708.853c3.807.763 8.516 3.042 14.133 6.851 5.614 3.806 10.229 8.754 13.846 14.842 4.38 7.806 9.657 13.754 15.846 17.847 6.184 4.093 12.419 6.136 18.699 6.136s11.704-.476 16.274-1.423c4.565-.952 8.848-2.383 12.847-4.285 1.713-12.758 6.377-22.559 13.988-29.41-10.848-1.14-20.601-2.857-29.264-5.14-8.658-2.286-17.605-5.996-26.835-11.14-9.235-5.137-16.896-11.516-22.985-19.126-6.09-7.614-11.088-17.61-14.987-29.979-3.901-12.374-5.852-26.648-5.852-42.826.0-23.035 7.52-42.637 22.557-58.817-7.044-17.318-6.379-36.732 1.997-58.24 5.52-1.715 13.706-.428 24.554 3.853 10.85 4.283 18.794 7.952 23.84 10.994 5.046 3.041 9.089 5.618 12.135 7.708 17.705-4.947 35.976-7.421 54.818-7.421s37.117 2.474 54.823 7.421l10.849-6.849c7.419-4.57 16.18-8.758 26.262-12.565 10.088-3.805 17.802-4.853 23.134-3.138 8.562 21.509 9.325 40.922 2.279 58.24 15.036 16.18 22.559 35.787 22.559 58.817.0 16.178-1.958 30.497-5.853 42.966-3.9 12.471-8.941 22.457-15.125 29.979-6.191 7.521-13.901 13.85-23.131 18.986-9.232 5.14-18.182 8.85-26.84 11.136-8.662 2.286-18.415 4.004-29.263 5.146 9.894 8.562 14.842 22.077 14.842 40.539v60.237c0 3.422 1.19 6.279 3.572 8.562 2.379 2.279 6.136 2.95 11.276 1.995 44.163-14.653 80.185-41.062 108.068-79.226 27.88-38.161 41.825-81.126 41.825-128.906C438.536 184.851 428.728 148.168 409.132 114.573z"/></svg></a></li></ul></div></div></div><div id=content><div class=container-fluid><article class="blog-post blog-post-with-toc"><header><h2 class=blog-post-title>Mise a jour des DNS de Gandi.net et utilisation d'un Proxy inversé avec un NAS Synology</h2><div class=blog-post-date><span>Dernière modification : 19 Avril 2024</span></div><div class=blog-post-date>Temps de lecture : 8 minute(s) - 1562 mots</div><div class=blog-post-tags><strong>Tags:</strong>
<a href=https://www.pragmatias.fr/tags/nas/>NAS</a>
<a href=https://www.pragmatias.fr/tags/synology/>Synology</a>
<a href=https://www.pragmatias.fr/tags/dns/>DNS</a></div></header><aside class=prag-toc><h1 class=prag-toc-head>Sommaire</h1><div class=prag-toc-body><nav id=TableOfContents><ol><li><a href=#objectif>Objectif</a><ol><li><a href=#contexte>Contexte</a></li><li><a href=#contrainte>Contrainte</a></li><li><a href=#usage>Usage</a></li><li><a href=#liste-des-étapes>Liste des étapes</a></li></ol></li><li><a href=#création-dun-jeton-daccès-à-lapi-de-gandinet>Création d&rsquo;un jeton d&rsquo;accès à l&rsquo;API de Gandi.net</a></li><li><a href=#configuration-du-routeur>Configuration du routeur</a></li><li><a href=#creation-et-mise-à-jour-des-dns-gandinet>Creation et mise à jour des DNS Gandi.net</a><ol><li><a href=#création-dun-répertoire-sur-le-nas-pour-stocker-le-script-à-exécuter>Création d&rsquo;un répertoire sur le NAS pour stocker le script à exécuter</a></li><li><a href=#création-dun-script-nommé-gandi_update_dnssh>Création d&rsquo;un script nommé <strong>Gandi_Update_DNS.sh</strong></a></li><li><a href=#automatisation-de-lexécution-du-script-gandi_update_dnssh>Automatisation de l&rsquo;exécution du script <strong>Gandi_Update_DNS.sh</strong></a></li><li><a href=#résultat-de-lexécution-du-script-gandi_update_dnssh>Résultat de l’exécution du script <strong>Gandi_Update_DNS.sh</strong></a></li></ol></li><li><a href=#mise-en-place-du-proxy-inversé-sur-le-nas-synology>Mise en place du Proxy inversé sur le NAS Synology</a></li></ol></nav></div></aside><a id=showTopBtn href=# class=prag-sticky-bot><svg height="24" id="Layer_1" style="enable-background:new 0 0 438.533 438.533" viewBox="0 0 438.533 438.533" width="24" xmlns:xlink="http://www.w3.org/1999/xlink"><path style="fill-rule:evenodd;clip-rule:evenodd;fill:" d="M409.133 109.203c-19.608-33.592-46.205-60.189-79.798-79.796C295.736 9.801 259.058.0 219.273.0c-39.781.0-76.47 9.801-110.063 29.407-33.595 19.604-60.192 46.201-79.8 79.796C9.801 142.8.0 179.489.0 219.267c0 39.78 9.804 76.463 29.407 110.062 19.607 33.592 46.204 60.189 79.799 79.798 33.597 19.605 70.283 29.407 110.063 29.407s76.47-9.802 110.065-29.407c33.593-19.602 60.189-46.206 79.795-79.798 19.603-33.596 29.403-70.284 29.403-110.062C438.533 179.485 428.732 142.795 409.133 109.203zM361.449 231.831l-25.981 25.981c-3.613 3.613-7.901 5.42-12.847 5.42-4.948.0-9.229-1.807-12.847-5.42l-53.954-53.961v143.32c0 4.948-1.813 9.232-5.428 12.847-3.613 3.62-7.898 5.427-12.847 5.427h-36.547c-4.948.0-9.231-1.807-12.847-5.427-3.617-3.614-5.426-7.898-5.426-12.847v-143.32l-53.959 53.961c-3.431 3.425-7.708 5.133-12.85 5.133-5.14.0-9.423-1.708-12.85-5.133l-25.981-25.981c-3.422-3.429-5.137-7.714-5.137-12.852.0-5.137 1.709-9.419 5.137-12.847l103.356-103.353 25.981-25.981c3.427-3.425 7.71-5.14 12.847-5.14 5.142.0 9.423 1.715 12.849 5.14l25.98 25.981 103.35 103.353c3.432 3.427 5.14 7.71 5.14 12.847C366.589 224.117 364.881 228.402 361.449 231.831z"/></svg>
</a><script>$(document).ready(function(){$("#showTopBtn").removeClass("prag-sticky-bot"),$("#showTopBtn").addClass("prag-sticky-hide"),$(function(){$(window).scroll(function(){$(this).scrollTop()>900?($("#showTopBtn").addClass("prag-sticky-bot"),$("#showTopBtn").removeClass("prag-sticky-hide")):($("#showTopBtn").addClass("prag-sticky-hide"),$("#showTopBtn").removeClass("prag-sticky-bot"))})})})</script><div class=blog-post-main><p>Vous trouverez dans cet article, l&rsquo;ensemble des éléments permettant de mettre à jour les <a href=https://en.wikipedia.org/wiki/Domain_Name_System>DNS</a> <a href=https://www.gandi.net/en>Gandi.net</a> à partir d&rsquo;un <a href=https://www.synology.com/en-en/products/DS223>NAS Synology</a> ainsi que de mettre en place un proxy inversé pour vos différents services sur votre réseau local.</p><h1 id=objectif>Objectif</h1><h2 id=contexte>Contexte</h2><p>Nous souhaitons utiliser un nom de domaine personnel de <a href=https://www.gandi.net/en>Gandi.net</a> nommé <code>testing.com</code> pour pouvoir accéder aux différents services existant derrière un accès (Routeur Livebox) internet personnel en fonction des sous-domaines définis.</p><p>Nous avons un réseau local contenant les équipements suivants :</p><ul><li>Routeur Livebox avec l&rsquo;adresse local 192.10.10.1 <em>(Adresse publique : 90.125.62.14)</em></li><li>NAS Synology avec l&rsquo;adresse local 192.10.10.2</li><li>Serveur local n°1 pour héberger le service VPN avec l&rsquo;adresse local 192.10.10.10</li><li>Serveur local n°2 pour héberger le service GAME avec l&rsquo;adresse local 192.10.10.20</li><li>Serveur local n°3 pour héberger le service TODO avec l&rsquo;adresse local 192.10.10.30</li></ul><p>Nous avons un nom de domaine <code>testing.com</code> actif chez <a href=https://www.gandi.net/en>Gandi.net</a>.</p><p><a href=/blog/web/20240419_nas_synology_dns_gandi_12.png><img alt="Obj - Step n°0" src=/blog/web/20240419_nas_synology_dns_gandi_12.png></a></p><p>Schéma :</p><p><a href=/blog/web/20240419_nas_synology_dns_gandi_07.png><img alt="Obj - Step n°1" src=/blog/web/20240419_nas_synology_dns_gandi_07.png></a></p><h2 id=contrainte>Contrainte</h2><p>Le routeur Livebox ne permet de gérer que l&rsquo;IPv4, l&rsquo;adresse IP publique n&rsquo;est pas fixe et on ne sait pas quand elle change, il faut donc pouvoir vérifier régulièrement notre adresse IP publique pour mettre à jour le DNS de Gandi.net lorsque cela est nécessaire.</p><h2 id=usage>Usage</h2><ul><li>Lorsqu&rsquo;un utilisateur souhaite accéder à l&rsquo;url <code>https://vpn.testing.com</code> alors il doit être redirigé automatiquement vers le serveur local n°1.</li><li>Lorsqu&rsquo;un utilisateur souhaite accéder à l&rsquo;url <code>http://game.testing.com</code> alors il doit être redirigé automatiquement vers le serveur local n°2.</li><li>Lorsqu&rsquo;un utilisateur souhaite accéder à l&rsquo;url <code>http://todo.testing.com</code> alors il doit être redirigé automatiquement vers le serveur local n°3.</li><li>Lorsqu&rsquo;un utilisateur souhaite accéder à l&rsquo;url <code>https://share.testing.com</code> alors il doit être redirigé automatiquement vers le NAS Synology.</li></ul><p>Schéma :
<a href=/blog/web/20240419_nas_synology_dns_gandi_08.png><img alt="Obj - Step n°2" src=/blog/web/20240419_nas_synology_dns_gandi_08.png></a></p><h2 id=liste-des-étapes>Liste des étapes</h2><p>Pour mettre en place les éléments nécessaires, nous allons réaliser les étapes suivantes :</p><ol><li>Création d&rsquo;un jeton d&rsquo;accès à l&rsquo;API de <a href=https://www.gandi.net/en>Gandi.net</a></li><li>Configuration du routeur Livebox pour rediriger le traffic internet entrant vers le NAS Synology</li><li>Creation et mise à jour des DNS <a href=https://www.gandi.net/en>Gandi.net</a> avec l&rsquo;adresse IP publique associée au routeur Livebox</li><li>Mise en place du Proxy inversé sur le NAS Synology pour accéder aux différents serveurs</li></ol><h1 id=création-dun-jeton-daccès-à-lapi-de-gandinet>Création d&rsquo;un jeton d&rsquo;accès à l&rsquo;API de Gandi.net</h1><p>Le jeton d&rsquo;accès va nous permettre de nous authentifier pour utiliser l&rsquo;API fourni par <a href=https://www.gandi.net/en>Gandi.net</a> afin de pouvoir automatiser les modifications nécessaires sur les enregistrements DNS lors des changements d&rsquo;adresse IP publique.</p><p>Démarche pour créer le jeton d&rsquo;accès :</p><ol><li>Connexion sur le compte d&rsquo;administration sur le site <a href=https://www.gandi.net/en>Gandi.net</a></li><li>Cliquez sur le menu <code>Organizations</code></li></ol><p><a href=/blog/web/20240419_nas_synology_dns_gandi_01.png><img alt="Token - Step n°1" src=/blog/web/20240419_nas_synology_dns_gandi_01.png></a></p><ol start=3><li>Cliquez sur l&rsquo;organisation souhaitée</li><li>Cliquez sur l&rsquo;onglet <code>Sharing</code></li></ol><p><a href=/blog/web/20240419_nas_synology_dns_gandi_02.png><img alt="Token - Step n°2" src=/blog/web/20240419_nas_synology_dns_gandi_02.png></a></p><ol start=5><li>Dans la partie <code>Personal Access Token (PAT)</code>, cliquez sur le bouton <code>Create a token</code></li><li>Renseigner les différents éléments nécesssaires<ol><li>Renseigner le nom du jeton (ex : <code>testing_dns_pat</code>)</li><li>Sélectionnez la durée de validité du jeton comprise entre 7 jours et 1 an (ex : <code>7 days</code>)</li><li>Cochez la case <code>Restrict to selected products</code> et sélectionnez le domaine souhaité (ex : <code>testing.com</code>)</li><li>Cochez la case <code>See and renew domain names</code></li><li>Cochez la case <code>Manage domain technical configurations</code></li><li>Cliquez sur le bouton <code>Create</code></li></ol></li></ol><p><a href=/blog/web/20240419_nas_synology_dns_gandi_03.png><img alt="Token - Step n°3" src=/blog/web/20240419_nas_synology_dns_gandi_03.png></a></p><ol start=7><li>Copier le Jeton d&rsquo;accès créé dans un endroit sécurisé car il ne sera plus accessible</li></ol><p><a href=/blog/web/20240419_nas_synology_dns_gandi_04.png><img alt="Token - Step n°4" src=/blog/web/20240419_nas_synology_dns_gandi_04.png></a></p><h1 id=configuration-du-routeur>Configuration du routeur</h1><p>Nous allons mettre en place une redirection du traffic internet entrant vers le NAS Synology par défaut pour que le NAS Synology puisse servir de reverse proxy pour rediriger les utilisateurs vers le serveur local défini en fonction de l&rsquo;adresse entrante utilisée.</p><p>Démarche pour configurer la box internet :</p><ol><li>Se connecter sur le compte d&rsquo;administration de la livebox</li><li>Allez dans le menu <code>Advanced Parameters</code></li><li>Cliquez sur l&rsquo;option <code>Network</code></li></ol><p><a href=/blog/web/20240419_nas_synology_dns_gandi_05.png><img alt="Box - Step n°1" src=/blog/web/20240419_nas_synology_dns_gandi_05.png></a></p><ol start=4><li>Cliquez sur l&rsquo;onglet <code>NAT / PAT</code></li><li>Ajoutez une règle pour rediriger le traffic HTTP entrant vers le NAS Synology et cliquez sur <code>Create</code><ol><li>Application/Service : Reverse Proxy HTTP</li><li>Internal Port : 80</li><li>External Port : 80</li><li>Protocol : TCP</li><li>Equipment : 192.10.10.2</li><li>External IP : All</li></ol></li><li>Ajoutez une règle pour rediriger le traffic HTTPS entrant vers le NAS Synology et cliquez sur <code>Create</code><ol><li>Application/Service : Reverse Proxy HTTPS</li><li>Internal Port : 443</li><li>External Port : 443</li><li>Protocol : TCP</li><li>Equipment : 192.10.10.2</li><li>External IP : All</li></ol></li></ol><p><a href=/blog/web/20240419_nas_synology_dns_gandi_06.png><img alt="Box - Step n°2" src=/blog/web/20240419_nas_synology_dns_gandi_06.png></a></p><h1 id=creation-et-mise-à-jour-des-dns-gandinet>Creation et mise à jour des DNS Gandi.net</h1><p><em>Attention : la prise en compte d&rsquo;un changement de DNS peut mettre plusieurs heures en fonction de sa configuration.</em></p><p>Pour créer et mettre à jour les informations sur le DNS de Gandi.net, nous allons utiliser l&rsquo;API publique de Gandi.net et créer un script qui sera exécuté directement sur le NAS Synology.</p><h2 id=création-dun-répertoire-sur-le-nas-pour-stocker-le-script-à-exécuter>Création d&rsquo;un répertoire sur le NAS pour stocker le script à exécuter</h2><ol><li>Allez dans l&rsquo;application <code>File Station</code></li><li>Naviguez jusqu&rsquo;au répertoire <code>Share</code></li><li>Créer un sous-répertoire <code>Script</code></li></ol><p><em>Note : L&rsquo;adresse complète du répertoire sera <code>volume1/Share/Script</code></em></p><h2 id=création-dun-script-nommé-gandi_update_dnssh>Création d&rsquo;un script nommé <strong>Gandi_Update_DNS.sh</strong></h2><p>Le script <code>Gandi_Update_DNS.sh</code> doit être créé dans le répertoire <code>volume1/Share/Script</code> du NAS Synology.</p><p>Nous définissons les paramètres important du script au début :</p><ul><li>Le jeton d&rsquo;accès à l&rsquo;API Gandi sera dans la variable : <code>TOKEN_GANDI</code></li><li>Le nom du domaine sera dans la variable : <code>DOMAIN_GANDI</code></li><li>La liste des sous domaines à mettre à jour seront dans la variable : <code>RECORDS_GANDI</code></li></ul><p>A partir de ces informations, nous allons pouvoir mettre en place le script suivant :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#ff79c6>#!/bin/sh
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span><span style=color:#ff79c6></span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span><span style=color:#6272a4># Configure data</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span><span style=color:#8be9fd;font-style:italic>TOKEN_GANDI</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;&lt;testing_dns_pat&gt;&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span><span style=color:#8be9fd;font-style:italic>DOMAIN_GANDI</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;testing.com&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span><span style=color:#8be9fd;font-style:italic>RECORDS_GANDI</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;share vpn game todo&#34;</span> <span style=color:#6272a4>#subdomain listing</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span><span style=color:#8be9fd;font-style:italic>RECORD_TYPE_GANDI</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;A&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span><span style=color:#8be9fd;font-style:italic>RECORD_TTL_GANDI</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;1200&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span><span style=color:#8be9fd;font-style:italic>RECORD_GANDI</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span><span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#8be9fd;font-style:italic>$RECORDS_GANDI</span> | cut -d<span style=color:#f1fa8c>&#34; &#34;</span> -f1<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span><span style=color:#6272a4># 1. Get Public IP</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span><span style=color:#8be9fd;font-style:italic>CURRENTIP_GANDI</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span>curl -s -4 ifconfig.co/ip<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span><span style=color:#8be9fd;font-style:italic>IPLENGTH_GANDI</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span><span style=color:#8be9fd;font-style:italic>echo</span> -n <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>CURRENTIP_GANDI</span><span style=color:#f1fa8c>}</span> | wc -m<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span><span style=color:#6272a4># Check that ifconfig.io give me an IP</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span><span style=color:#ff79c6>if</span> <span style=color:#ff79c6>[</span> -z <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>CURRENTIP_GANDI</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span><span style=color:#ff79c6>then</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19</span><span>  <span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;\n</span><span style=color:#ff79c6>$(</span>date +<span style=color:#f1fa8c>&#34;%Y-%m-%d %H:%M:%S&#34;</span><span style=color:#ff79c6>)</span><span style=color:#f1fa8c> - Error - CURRENTIP_GANDI is empty&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20</span><span>  <span style=color:#8be9fd;font-style:italic>exit</span> <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21</span><span><span style=color:#ff79c6>fi</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23</span><span><span style=color:#ff79c6>if</span> <span style=color:#ff79c6>[</span> <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>IPLENGTH_GANDI</span><span style=color:#f1fa8c>}</span> -gt <span style=color:#bd93f9>16</span> <span style=color:#ff79c6>]</span> <span style=color:#ff79c6>||</span> <span style=color:#ff79c6>[</span> <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>IPLENGTH_GANDI</span><span style=color:#f1fa8c>}</span> -lt <span style=color:#bd93f9>7</span> <span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24</span><span><span style=color:#ff79c6>then</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25</span><span>  <span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;\n</span><span style=color:#ff79c6>$(</span>date +<span style=color:#f1fa8c>&#34;%Y-%m-%d %H:%M:%S&#34;</span><span style=color:#ff79c6>)</span><span style=color:#f1fa8c> - Error - CURRENTIP_GANDI issue : [</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>CURRENTIP_GANDI</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>]&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26</span><span>  <span style=color:#8be9fd;font-style:italic>exit</span> <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27</span><span><span style=color:#ff79c6>fi</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30</span><span><span style=color:#6272a4># 2. Get gandi&#39;s NS for my domain</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31</span><span><span style=color:#8be9fd;font-style:italic>NS_GANDI</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span>curl -X GET <span style=color:#f1fa8c>&#34;https://api.gandi.net/v5/livedns/domains/</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>DOMAIN_GANDI</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>/nameservers&#34;</span> -H <span style=color:#f1fa8c>&#34;authorization: Bearer </span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>TOKEN_GANDI</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span> | jq <span style=color:#f1fa8c>&#39;.[0]&#39;</span> | sed <span style=color:#f1fa8c>&#39;s/&#34;//g&#39;</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33</span><span><span style=color:#6272a4># 3. Get the last IP recorded</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34</span><span><span style=color:#8be9fd;font-style:italic>LASTREGISTEREDIP_GANDI</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span>/var/packages/DNSServer/target/bin/dig +short <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>RECORD_GANDI</span><span style=color:#f1fa8c>}</span>.<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>DOMAIN_GANDI</span><span style=color:#f1fa8c>}</span> @<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>NS_GANDI</span><span style=color:#f1fa8c>}</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35</span><span><span style=color:#8be9fd;font-style:italic>LASTREGISTEREDIPLENGTH_GANDI</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span><span style=color:#8be9fd;font-style:italic>echo</span> -n <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LASTREGISTEREDIP_GANDI</span><span style=color:#f1fa8c>}</span> | wc -m<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37</span><span><span style=color:#ff79c6>if</span> <span style=color:#ff79c6>[</span> -z <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LASTREGISTEREDIP_GANDI</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38</span><span><span style=color:#ff79c6>then</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39</span><span>  <span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;\n</span><span style=color:#ff79c6>$(</span>date +<span style=color:#f1fa8c>&#34;%Y-%m-%d %H:%M:%S&#34;</span><span style=color:#ff79c6>)</span><span style=color:#f1fa8c> - Error - LASTREGISTEREDIP_GANDI is empty&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40</span><span>  <span style=color:#8be9fd;font-style:italic>exit</span> <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41</span><span><span style=color:#ff79c6>fi</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43</span><span><span style=color:#ff79c6>if</span> <span style=color:#ff79c6>[</span> <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LASTREGISTEREDIPLENGTH_GANDI</span><span style=color:#f1fa8c>}</span> -gt <span style=color:#bd93f9>16</span> <span style=color:#ff79c6>]</span> <span style=color:#ff79c6>||</span> <span style=color:#ff79c6>[</span> <span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LASTREGISTEREDIPLENGTH_GANDI</span><span style=color:#f1fa8c>}</span> -lt <span style=color:#bd93f9>7</span> <span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44</span><span><span style=color:#ff79c6>then</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45</span><span>  <span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;\n</span><span style=color:#ff79c6>$(</span>date +<span style=color:#f1fa8c>&#34;%Y-%m-%d %H:%M:%S&#34;</span><span style=color:#ff79c6>)</span><span style=color:#f1fa8c> - Error - LASTREGISTEREDIP_GANDI issue : [</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LASTREGISTEREDIP_GANDI</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>]&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46</span><span>  <span style=color:#8be9fd;font-style:italic>exit</span> <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47</span><span><span style=color:#ff79c6>fi</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50</span><span><span style=color:#6272a4># 4. Update if needed</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51</span><span><span style=color:#ff79c6>if</span> <span style=color:#ff79c6>[</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>CURRENTIP_GANDI</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span> !<span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>LASTREGISTEREDIP_GANDI</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#ff79c6>]</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52</span><span><span style=color:#ff79c6>then</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53</span><span>    <span style=color:#ff79c6>for</span> SUB_GANDI in <span style=color:#8be9fd;font-style:italic>$RECORDS_GANDI</span>; <span style=color:#ff79c6>do</span> <span style=color:#6272a4># Loop on all domaine to use the same IP Address</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54</span><span>      <span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;\n</span><span style=color:#ff79c6>$(</span>date +<span style=color:#f1fa8c>&#34;%Y-%m-%d %H:%M:%S&#34;</span><span style=color:#ff79c6>)</span><span style=color:#f1fa8c> - Info - DNS Record for [</span><span style=color:#8be9fd;font-style:italic>$SUB_GANDI</span><span style=color:#f1fa8c>] sent&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55</span><span>      curl -X PUT https://api.gandi.net/v5/livedns/domains/<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>DOMAIN_GANDI</span><span style=color:#f1fa8c>}</span>/records/<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>SUB_GANDI</span><span style=color:#f1fa8c>}</span>/<span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>RECORD_TYPE_GANDI</span><span style=color:#f1fa8c>}</span> <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56</span><span><span style=color:#f1fa8c></span>              -H <span style=color:#f1fa8c>&#34;authorization: Bearer </span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>TOKEN_GANDI</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57</span><span><span style=color:#f1fa8c></span>              -H <span style=color:#f1fa8c>&#34;Content-Type: application/json&#34;</span> <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58</span><span><span style=color:#f1fa8c></span>              -d <span style=color:#f1fa8c>&#34;{\&#34;rrset_values\&#34;: [\&#34;</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>CURRENTIP_GANDI</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>\&#34;], \&#34;rrset_ttl\&#34;: &#34;</span><span style=color:#f1fa8c>${</span><span style=color:#8be9fd;font-style:italic>RECORD_TTL_GANDI</span><span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;}&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59</span><span>    <span style=color:#ff79c6>done</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60</span><span>    <span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;\n</span><span style=color:#ff79c6>$(</span>date +<span style=color:#f1fa8c>&#34;%Y-%m-%d %H:%M:%S&#34;</span><span style=color:#ff79c6>)</span><span style=color:#f1fa8c> - Info - DNS Record has changed !!!!&#34;</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61</span><span>    <span style=color:#8be9fd;font-style:italic>exit</span> <span style=color:#bd93f9>2</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62</span><span><span style=color:#ff79c6>fi</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63</span><span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64</span><span><span style=color:#8be9fd;font-style:italic>exit</span> <span style=color:#bd93f9>0</span>
</span></span></code></pre></div><p>Les grandes étapes sont les suivantes :</p><ol><li><code>curl -s -4 ifconfig.co/ip</code> (résultat : <code>90.125.62.14</code>) : Récupération de notre adresse IP publique actuelle</li><li><code>curl -X GET "https://api.gandi.net/v5/livedns/domains/${DOMAIN_GANDI}/nameservers" -H "authorization: Bearer ${TOKEN_GANDI}" | jq '.[0]' | sed 's/"//g'</code> : Récupération du <code>nameserver</code> principal de <a href=https://www.gandi.net/en>Gandi.net</a> pour notre domaine <code>testing.com</code></li><li><code>/var/packages/DNSServer/target/bin/dig +short ${RECORD_GANDI}.${DOMAIN_GANDI} @${NS_GANDI}</code> : Récupération de l&rsquo;adresse IP publique enregistrée dans le DNS de <a href=https://www.gandi.net/en>Gandi.net</a> pour le domaine <code>testing.com</code></li><li>Dans le cas où l&rsquo;adresse IP publique actuelle est différente de l&rsquo;adresse IP publique enregistrée dans le DNS de Gandi.net alors on met à jour l&rsquo;information pour chaque sous domaine renseigné.</li></ol><h2 id=automatisation-de-lexécution-du-script-gandi_update_dnssh>Automatisation de l&rsquo;exécution du script <strong>Gandi_Update_DNS.sh</strong></h2><p>Pour exécuter automatiquement un script sur le NAS Synology, les étapes sont les suivantes :</p><ol><li>Cliquez sur le menu <code>Main menu</code> (en haut à gauche sur l&rsquo;écran principal)</li><li>Cliquez sur l&rsquo;application <code>Control Panel</code></li><li>Cliquez sur le menu <code>Task Scheduler</code></li><li>Cliquez sur le bouton <code>Create</code> et sélectionnez l&rsquo;option <code>Scheduled Task > User-defined script</code><ol><li>Renseignez les informations de l&rsquo;onglet <code>General</code> et cochez la case <code>Enabled</code></li><li>Renseignez les informations de l&rsquo;onglet <code>Schedule</code> avec la fréquence et l&rsquo;horaire d&rsquo;exécution du script</li><li>Renseignez les informations de l&rsquo;onglet <code>Task Settings</code><ol><li>Cochez la case <code>Send run details by email</code></li><li>Cochez la case <code>Send run details only when the scrip terminates abnormally</code></li><li>Renseignez votre mail pour recevoir les informations en cas d&rsquo;erreur du script</li><li>Renseignez la commande a exécuter dans <code>User-defined script</code>. La commande est <code>bash &lt;script path>/Gandi_Update_DNS.sh</code></li></ol></li><li>Cliquez sur le bouton <code>OK</code></li></ol></li><li>Vérifiez que la case est bien cochée pour le script ajouté dans l&rsquo;écran récapitulatif</li></ol><p><a href=/blog/web/20240419_nas_synology_dns_gandi_13.png><img alt="CRON - Step n°1" src=/blog/web/20240419_nas_synology_dns_gandi_13.png></a></p><h2 id=résultat-de-lexécution-du-script-gandi_update_dnssh>Résultat de l’exécution du script <strong>Gandi_Update_DNS.sh</strong></h2><p><a href=/blog/web/20240419_nas_synology_dns_gandi_14.png><img alt="Execution - Step n°1" src=/blog/web/20240419_nas_synology_dns_gandi_14.png></a></p><h1 id=mise-en-place-du-proxy-inversé-sur-le-nas-synology>Mise en place du Proxy inversé sur le NAS Synology</h1><p>Se connecter au NAS Synology et suivre les étapes suivantes :</p><ol><li>Cliquez sur le menu <code>Main menu</code> (en haut à gauche sur l&rsquo;écran principal)</li><li>Cliquez sur l&rsquo;application <code>Control Panel</code></li><li>Cliquez sur le menu <code>Login Portal</code></li><li>Cliquez sur l&rsquo;onglet <code>Advanced</code></li><li>Cliquez sur le bouton <code>Reverse Proxy</code></li></ol><p><a href=/blog/web/20240419_nas_synology_dns_gandi_09.png><img alt="Proxy - Step n°1" src=/blog/web/20240419_nas_synology_dns_gandi_09.png></a></p><ol start=6><li>Cliquez sur le bouton <code>Create</code></li><li>Renseignez les éléments suivant pour la redirection de l&rsquo;adresse <code>vpn.testing.com</code> vers le serveur n°1 (192.10.10.10) et cliquez sur le bouton <code>Save</code><ol><li>Reverse Proxy Name : <code>VPN (HTTPS)</code></li><li>Source<ol><li>Protocol : <code>HTTPS</code></li><li>Hostname: <code>vpn.testing.com</code></li><li>Port : <code>443</code></li></ol></li><li>Destination :<ol><li>Protocol : <code>HTTPS</code></li><li>Hostname : <code>192.10.10.10</code></li><li>Port : <code>443</code></li></ol></li></ol></li></ol><p><a href=/blog/web/20240419_nas_synology_dns_gandi_10.png><img alt="Proxy - Step n°2" src=/blog/web/20240419_nas_synology_dns_gandi_10.png></a></p><ol start=8><li>Recommencez l&rsquo;opération pour la redirection de l&rsquo;adresse <code>game.testing.com</code>vers le serveur local n°2 (192.10.10.20)<ol><li>Reverse Proxy Name : <code>GAME (HTTP)</code></li><li>Source<ol><li>Protocol : <code>HTTP</code></li><li>Hostname: <code>game.testing.com</code></li><li>Port : <code>80</code></li></ol></li><li>Destination :<ol><li>Protocol : <code>HTTP</code></li><li>Hostname : <code>192.10.10.20</code></li><li>Port : <code>80</code></li></ol></li></ol></li><li>Recommencez l&rsquo;opération pour la redirection de l&rsquo;adresse <code>todo.testing.com</code>vers le serveur local n°3 (192.10.10.30)<ol><li>Reverse Proxy Name : <code>TODO (HTTP)</code></li><li>Source<ol><li>Protocol : <code>HTTP</code></li><li>Hostname: <code>todo.testing.com</code></li><li>Port : <code>80</code></li></ol></li><li>Destination :<ol><li>Protocol : <code>HTTP</code></li><li>Hostname : <code>192.10.10.30</code></li><li>Port : <code>80</code></li></ol></li></ol></li></ol><p>Résultat de la configuration du Proxy inversé :</p><p><a href=/blog/web/20240419_nas_synology_dns_gandi_11.png><img alt="Proxy - Step n°3" src=/blog/web/20240419_nas_synology_dns_gandi_11.png></a></p></div></article></div></div><footer><div class="container-fluid prag-bg-primary prag-foot">Généré avec <a href=https://gohugo.io/>Hugo</a>
&nbsp; - &nbsp;
<a href=https://en.wikipedia.org/wiki/WTFPL>WTFPL license</a> © 2018–2024</div></footer></body></html>